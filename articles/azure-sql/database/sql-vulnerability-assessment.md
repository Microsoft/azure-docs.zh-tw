---
title: SQL 弱點評定
titleSuffix: Azure SQL Database & SQL Managed Instance & Azure Synapse Analytics
description: 瞭解如何設定 SQL 弱點評定，以及解讀 Azure SQL Database、Azure SQL 受控執行個體和 Azure Synapse Analytics 的評量報告。
services: sql-database
ms.service: sql-db-mi
ms.subservice: security
ms.custom: sqldbrb=3
ms.devlang: ''
ms.topic: how-to
author: barmichal
ms.author: mibar
ms.reviewer: vanto
ms.date: 09/21/2020
tags: azure-synapse
ms.openlocfilehash: 05dbf0689e0cb217fc5eb40bdeaf9d6586bcf72e
ms.sourcegitcommit: 4e70fd4028ff44a676f698229cb6a3d555439014
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/28/2021
ms.locfileid: "98951558"
---
# <a name="sql-vulnerability-assessment-helps-you-identify-database-vulnerabilities"></a>SQL 弱點評估可協助您識別資料庫弱點
[!INCLUDE[appliesto-sqldb-sqlmi](../includes/appliesto-sqldb-sqlmi.md)]

SQL 弱點評定是一項易於設定的服務，可探索、追蹤及協助您補救潛在的資料庫弱點。 使用此工具可主動改進您的資料庫安全性。

弱點評定是 [Azure Defender FOR SQL](azure-defender-for-sql.md) 供應專案的一部分，這是 advanced sql 安全性功能的整合套件。 您可以透過中央 Azure Defender for SQL 入口網站來存取和管理弱點評定。

> [!NOTE]
> Azure SQL Database、Azure SQL 受控執行個體和 Azure Synapse Analytics 都支援弱點評定。 本文的其餘部分會將 Azure SQL Database、Azure SQL 受控執行個體和 Azure Synapse Analytics 中的資料庫統稱為資料庫，而且伺服器會參考裝載資料庫的 [伺服器](logical-servers.md) 以進行 Azure SQL Database 和 Azure Synapse。

## <a name="vulnerability-assessment"></a>弱點評量

SQL 弱點評定是一項服務，可讓您看到安全性狀態。 弱點評定包含可採取動作的步驟來解決安全性問題，並增強您的資料庫安全性。 它可協助您：

- 符合要求資料庫掃描報告的合規性需求。
- 符合資料隱私權標準。
- 監視難以追蹤變更的動態資料庫環境。

弱點評定是 Azure SQL Database 內建的掃描服務。 此服務會採用規則的知識庫，以標示安全性弱點。 它會反白顯示與最佳作法的偏差，例如錯誤配置、過多的許可權，以及未受保護的敏感性資料。

這些規則是以 Microsoft 的最佳作法為基礎，並且著重于對資料庫和其重要資料造成最大風險的安全性問題。 其中涵蓋了資料庫層級的問題和伺服器層級的安全性問題，例如伺服器防火牆設定和伺服器層級許可權。 這些規則也代表各種不同管理機構要符合其合規性標準的要求。

掃描結果包含可以解決個別問題的可操作步驟，並於合適的情況下提供自訂的補救指令碼。 您可以為您的環境自訂評量報告，方法是設定可接受的基準：

- 許可權設定
- 功能設定
- 資料庫設定

## <a name="implement-vulnerability-assessment"></a>實施弱點評定

下列步驟會執行弱點評估：

### <a name="1-run-a-scan"></a>1.執行掃描

1. 移至 [Azure 入口網站](https://portal.azure.com)中的 AZURE SQL DATABASE、SQL 受控執行個體資料庫或 Azure Synapse 資源。

1. 在 [ **安全性** ] 標題下，選取 [ **安全性中心**]。

1. 然後按一下 [**弱點評估**] 窗格上的 [**設定**]，開啟整個伺服器或受控實例的 [弱點評估設定] 窗格。  

    > [!NOTE]
    > 如需在防火牆和 Vnet 背後儲存弱點評定掃描的詳細資訊，請參閱 [將弱點評定掃描結果儲存在可在防火牆和 vnet 後方存取的儲存體帳戶](sql-database-vulnerability-assessment-storage.md)。

1. 設定儲存體帳戶，以儲存伺服器或受控實例上所有資料庫的掃描結果。 如需儲存體帳戶的資訊，請參閱[關於 Azure 儲存體帳戶](../../storage/common/storage-account-create.md)。 設定儲存體之後，請選取 [ **掃描** ] 以掃描您的資料庫是否有弱點。

![掃描資料庫](./media/sql-vulnerability-assessment/pp_va_initialize.png)

  > [!NOTE]
  > 掃描是輕量且安全的。 這需要幾秒鐘的時間來執行，而且完全是唯讀的。 它不會對您的資料庫進行任何變更。

### <a name="2-view-the-report"></a>2.檢視報告

當掃描完成時，您的掃描報告會自動顯示在 Azure 入口網站中。 報表會顯示您的安全性狀態總覽。 它會列出找到的問題數量和其各自的嚴重性。 結果包含與安全性相關設定的偏差（例如資料庫主體和角色及其相關聯的許可權）之偏差的警告。 掃描報告也會提供在資料庫中探索到的敏感性資料的對應。 其中包含使用 [資料探索和分類](data-discovery-and-classification-overview.md)來分類該資料的建議。

![檢視報告](./media/sql-vulnerability-assessment/pp_main_getstarted.png)

### <a name="3-analyze-the-results-and-resolve-issues"></a>3.分析結果並解決問題

檢閱您的結果，並判斷報告中的哪些調查結果是環境中真正的安全性問題。 向下鑽研至每個失敗的結果，了解調查結果的影響，以及每個安全性檢查失敗的原因。 使用報告提供的可操作補救資訊來解決問題。

![分析報告](./media/sql-vulnerability-assessment/pp_fail_rule_show_remediation.png)

### <a name="4-set-your-baseline"></a>4. 設定您的基準

當您檢查評量結果時，可以將特定結果標示為環境中可接受的 *基準* 。 基準本質上就是自訂報告結果的方式。 在後續的掃描中，會將符合基準的結果視為通過。 在您建立基準安全性狀態之後，弱點評定只會報告基準的偏差。 如此一來，您就可以專注于相關的問題。

![設定基準](./media/sql-vulnerability-assessment/pp_fail_rule_show_baseline.png)

### <a name="5-run-a-new-scan-to-see-your-customized-tracking-report"></a>5.執行新的掃瞄來查看您的自訂追蹤報告

當您完成 **規則基準** 的設定之後，請執行新的掃描以查看自訂報表。 弱點評定現在只會報告偏離您核准基準狀態的安全性問題。

![檢視您的自訂報告](./media/sql-vulnerability-assessment/pp_pass_main_with_baselines.png)

弱點評量現在可用來監視您的資料庫，隨時維護高度安全性並符合組織原則。 如果需要相容性報告，弱點評定報告可能有助於協助合規性程式。

### <a name="6-set-up-periodic-recurring-scans"></a>6. 設定週期性週期性掃描

移至 [弱點評定] 設定以開啟 **週期性週期性掃描**。 此設定會將弱點評估設定為每週自動在您的資料庫上執行掃描。 掃描結果摘要會傳送至您提供的電子郵件地址。

![週期性掃描設定](./media/sql-vulnerability-assessment/pp_recurring_scans.png)

### <a name="7-export-an-assessment-report"></a>7. 匯出評量報告

選取 [ **匯出掃描結果** ]，以建立您的掃描結果可下載的 Excel 報表。 這份報表包含顯示評量摘要的 [摘要] 索引標籤。 報表包含所有失敗的檢查。 它也包含 [ **結果** ] 索引標籤，其中包含掃描的完整結果集。 結果包含所有已執行的檢查，以及每個檢查的結果詳細資料。

### <a name="8-view-scan-history"></a>8. 查看掃描歷程記錄

在 [弱點評估] 窗格中選取 [ **掃描歷程記錄** ]，以查看先前在此資料庫上執行之所有掃描的歷程記錄。 選取清單中的特定掃描，以檢視該掃描的詳細結果。

弱點評量現在可用來監視您的資料庫，隨時維護高度安全性並符合組織原則。 如果需要相容性報告，弱點評定報告可能有助於協助合規性程式。

## <a name="manage-vulnerability-assessments-by-using-azure-powershell"></a>使用 Azure PowerShell 管理弱點評定

[!INCLUDE [updated-for-az](../../../includes/updated-for-az.md)]
> [!IMPORTANT]
> 仍支援 PowerShell Azure Resource Manager 模組，但未來所有的開發都是針對 Az. Sql 模組。 如需這些 Cmdlet，請參閱 [AzureRM.Sql](/powershell/module/AzureRM.Sql/) \(英文\)。 Az 模組和 AzureRm 模組中命令的引數本質上完全相同。

您可以使用 Azure PowerShell Cmdlet，以程式設計方式管理您的弱點評定。 支援的 Cmdlet 如下：

| Cmdlet 名稱做為連結 | Description |
| :-------------------- | :---------- |
| [Clear-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | 清除弱點評定規則基準。<br/>首先，請先設定基準，再使用這個 Cmdlet 來清除它。 |
| [Clear-AzSqlDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentSetting) | 清除資料庫的弱點評定設定。 |
| [Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | 清除受管理資料庫的弱點評定規則基準。<br/>首先，請先設定基準，再使用這個 Cmdlet 來清除它。 |
| [Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | 清除受管理資料庫的弱點評定設定。 |
| [Clear-AzSqlInstanceVulnerabilityAssessmentSetting](/powershell/module/az.sql/Clear-AzSqlInstanceVulnerabilityAssessmentSetting) | 清除受控實例的弱點評定設定。 |
| [轉換-AzSqlDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Convert-azSqlDatabaseVulnerabilityAssessmentScan) | 將資料庫的弱點評定掃描結果轉換為 Excel 檔案。 |
| [轉換-AzSqlInstanceDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Convert-AzSqlInstanceDatabaseVulnerabilityAssessmentScan) | 將受控資料庫的弱點評定掃描結果轉換為 Excel 檔案。 |
| [AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | 取得指定規則之資料庫的弱點評定規則基準。 |
| [AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | 取得指定規則之受控資料庫的弱點評定規則基準。 |
| [AzSqlDatabaseVulnerabilityAssessmentScanRecord](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentScanRecord) | 取得與指定資料庫相關聯的所有弱點評定掃描記錄。 |
| [AzSqlInstanceDatabaseVulnerabilityAssessmentScanRecord](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentScanRecord) | 取得與指定的受控資料庫相關聯的所有弱點評定掃描記錄。 |
| [AzSqlDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentSetting) | 傳回資料庫的弱點評定設定。 |
| [AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | 傳回受管理資料庫的弱點評定設定。 |
| [設定-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Set-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | 設定弱點評定規則基準。 |
| [設定-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Set-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | 設定受管理資料庫的弱點評定規則基準。 |
| [開始-AzSqlDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Start-azSqlDatabaseVulnerabilityAssessmentScan) | 在資料庫上觸發弱點評估掃描的啟動。 |
| [開始-AzSqlInstanceDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Start-AzSqlInstanceDatabaseVulnerabilityAssessmentScan) | 在受控資料庫上觸發弱點評估掃描的啟動。 |
| [更新-AzSqlDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Update-azSqlDatabaseVulnerabilityAssessmentSetting) | 更新資料庫的弱點評定設定。 |
| [更新-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Update-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | 更新受控資料庫的弱點評定設定。 |
| [更新-AzSqlInstanceVulnerabilityAssessmentSetting](/powershell/module/az.sql/Update-AzSqlInstanceVulnerabilityAssessmentSetting) | 更新受控實例的弱點評定設定。 |
| &nbsp; | &nbsp; |

如需指令碼範例，請參閱 [Azure SQL 弱點評定的 PowerShell 支援](/archive/blogs/sqlsecurity/azure-sql-vulnerability-assessment-now-with-powershell-support)。

## <a name="manage-vulnerability-assessment-baseline-rules-by-using-resource-manager-templates"></a>使用 Resource Manager 範本管理弱點評定基準規則

若要使用 Azure Resource Manager 範本來設定弱點評定基準，請使用 `Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines` 類型。

在新增基準之前，請確定您已啟用 `vulnerabilityAssessments` 。

以下範例示範如何將基準規則 VA2065 定義為 `master` 資料庫，並將 VA1143 到 `user` 資料庫做為 Resource Manager 範本中的資源：

```json
   "resources": [
      {
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/master')]",
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "FirewallRuleName3",
                     "StartIpAddress",
                     "EndIpAddress"
                  ]
               },
               {
                  "result": [
                     "FirewallRuleName4",
                     "62.92.15.68",
                     "62.92.15.68"
                  ]
               }
            ]
         },
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA2130/Default')]",
         "dependsOn": [
            "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
         ],
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "dbo"
                  ]
               }
            ]
         }
      }
   ]
```

針對 `master` 資料庫和 `user` 資料庫，資源名稱的定義方式不同：

- Master 資料庫-"name"： "[concat (參數 ( ' server_name ' ) ，'/'，參數 ( ' database_name ' ) ，'/default/VA2065/<b>master</b>' ) ]"，
- 使用者資料庫-"name"： "[concat (參數 ( ' server_name ' ) ，'/'，參數 ( ' database_name ' ) ，'/default/VA2065/<b>default</b>' ) ]"，

若要將布林值類型處理為 true/false，請使用二進位輸入（例如 "1"/"0"）來設定基準結果。

```json
   {
      "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
      "apiVersion": "2018-06-01-preview",
      "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA1143/Default')]",

      "dependsOn": [
         "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
      ],

      "properties": {
         "baselineResults": [
            {
               "result": [
                  "1"
               ]
            }
         ]
      }

   }
```

## <a name="next-steps"></a>下一步  

- 深入了解[適用於 SQL 的 Azure Defender](azure-defender-for-sql.md)。
- 深入瞭解 [資料探索和分類](data-discovery-and-classification-overview.md)。
- 瞭解如何 [將弱點評定掃描結果儲存在可在防火牆和 vnet 背後存取的儲存體帳戶](sql-database-vulnerability-assessment-storage.md)。
