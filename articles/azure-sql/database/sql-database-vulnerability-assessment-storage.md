---
title: 將弱點評定掃描結果儲存到可在防火牆和 Vnet 後方存取的儲存體帳戶
description: 提供有關如何在可透過防火牆或 VNet 存取的儲存體帳戶中儲存弱點評估 (VA) 掃描的指示
services: sql-database
ms.service: sql-db-mi
ms.subservice: security
ms.topic: how-to
author: davidtrigano
ms.author: datrigan
ms.reviewer: vanto
ms.date: 12/01/2020
ms.openlocfilehash: 07d9d46d9ef234070a213fff25f883b29ebf604b
ms.sourcegitcommit: 100390fefd8f1c48173c51b71650c8ca1b26f711
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/27/2021
ms.locfileid: "98894638"
---
# <a name="store-vulnerability-assessment-scan-results-in-a-storage-account-accessible-behind-firewalls-and-vnets"></a>將弱點評定掃描結果儲存到可在防火牆和 Vnet 後方存取的儲存體帳戶
[!INCLUDE[appliesto-sqldb-sqlmi](../includes/appliesto-sqldb-sqlmi.md)]

如果您要在 Azure 中針對某些 Vnet 或服務限制存取您的儲存體帳戶，您必須啟用適當的設定，讓弱點評估 (VA) 掃描 SQL database 或受控實例具有該儲存體帳戶的存取權。

## <a name="enable-azure-sql-database-va-scanning-access-to-the-storage-account"></a>啟用儲存體帳戶的 Azure SQL Database VA 掃描存取權

如果您已將 VA 儲存體帳戶設定為只能由特定的網路或服務存取，您將需要確保 Azure SQL Database 的 VA 掃描能夠將掃描儲存在儲存體帳戶上。 您可以使用現有的儲存體帳戶，或建立新的儲存體帳戶，為 [邏輯 SQL server](logical-servers.md)上的所有資料庫儲存 VA 掃描結果。

> [!NOTE]
> 弱點評定服務無法存取以防火牆或 Vnet 保護的儲存體帳戶（如果需要儲存體存取金鑰）。

移至包含儲存體帳戶的 **資源群組** ，並存取 **儲存體帳戶** 窗格。 在 [ **設定**] 底下，選取 [ **防火牆和虛擬網路**]。

確定已核取 [ **允許信任的 Microsoft 服務存取此儲存體帳戶** ]。

:::image type="content" source="media/sql-database-vulnerability-assessment-storage/storage-allow-microsoft-services.png" alt-text="顯示 [防火牆和虛擬網路] 對話方塊的螢幕擷取畫面，其中已選取 [允許信任的 Microsoft 服務來存取此儲存體帳戶。":::

若要找出正在使用的儲存體帳戶，請移至 [ **SQL server** ] 窗格中 [Azure 入口網站](https://portal.azure.com)的 [ **安全性**] 底下，選取 [ **安全性中心**]。

:::image type="content" source="../database/media/azure-defender-for-sql/va-storage.png" alt-text="設定弱點評估":::

## <a name="store-va-scan-results-for-azure-sql-managed-instance-in-a-storage-account-that-can-be-accessed-behind-a-firewall-or-vnet"></a>將 Azure SQL 受控執行個體的 VA 掃描結果儲存在可在防火牆或 VNet 後方存取的儲存體帳戶中

由於受控執行個體不是受信任的 Microsoft 服務，且具有與儲存體帳戶不同的 VNet，因此執行 VA 掃描將會產生錯誤。

若要在受控實例上支援 VA 掃描，請遵循下列步驟：

1. 在 [ **SQL 受控實例** ] 窗格中，按一下 [ **總覽** ] 標題底下的 [ **虛擬網路/子網** ] 連結。 這會帶您前往 [ **虛擬網路** ] 窗格。

   :::image type="content" source="../managed-instance/media/public-endpoint-configure/mi-overview.png" alt-text="mi-overview2":::

1. 在 [設定] 下，選取 [子網路]。 按一下 [新增] 窗格中的 [ **子網** ]，以新增子網，並將其委派給 *Sql\managedInstance*。 如需詳細資訊，請參閱 [管理子網](../../virtual-network/virtual-network-manage-subnet.md)。

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/mi-subnets.png" alt-text="螢幕擷取畫面會顯示已委派 Microsoft 的子網 sql\managedInstance。":::

1. 在 [ **虛擬網路** ] 窗格的 [ **設定**] 底下，選取 [ **服務端點**]。 在新的窗格 **中按一下 [新增]** ，然後將 *Microsoft 儲存* 服務新增為新的服務端點。 請確定已選取 *ManagedInstance* 子網。 按一下 **[新增]** 。

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/mi-service-endpoint.png" alt-text="螢幕擷取畫面顯示 [新增服務端點]，您可以在其中將 Microsoft 儲存體服務新增為端點。":::

1. 移至您已選取用來儲存 VA 掃描的 **儲存體帳戶** 。 在 [ **設定**] 底下，選取 [ **防火牆和虛擬網路**]。 按一下 [新增現有的虛擬網路]。 選取您的受控實例虛擬網路和子網，然後按一下 [ **新增**]。

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/storage-firewall.png" alt-text="螢幕擷取畫面顯示 [防火牆] 和 [虛擬網路] 窗格，其中包含 [新增現有的虛擬網路] 連結。":::

您現在應該能夠將受控實例的 VA 掃描儲存在儲存體帳戶中。

## <a name="next-steps"></a>後續步驟

- [弱點評定](sql-vulnerability-assessment.md)
- [建立 Azure 儲存體帳戶](../../storage/common/storage-account-create.md)
- [適用於 SQL 的 Azure Defender](azure-defender-for-sql.md)
