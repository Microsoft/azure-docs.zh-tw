---
title: Azure Active Directory 驗證程式庫 (ADAL) 用戶端的錯誤處理最佳做法
description: 提供適用於 ADAL 用戶端應用程式的錯誤處理指引和最佳做法。
services: active-directory
documentationcenter: ''
author: danieldobalian
manager: mtillman
ms.author: celested
ms.service: active-directory
ms.component: develop
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 02/27/2017
ms.custom: ''
ms.openlocfilehash: db1d2f16c6497ce3c14d162a9c354dda995058f6
ms.sourcegitcommit: 32d218f5bd74f1cd106f4248115985df631d0a8c
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/24/2018
ms.locfileid: "46974777"
---
# <a name="error-handling-best-practices-for-azure-active-directory-authentication-library-adal-clients"></a>Azure Active Directory 驗證程式庫 (ADAL) 用戶端的錯誤處理最佳做法

本文提供開發人員在使用 ADAL 來驗證使用者時，可能會遇到的錯誤類型指引。 使用 ADAL 時，在幾種情況下，開發人員可能需要介入並處理錯誤。 適當處理錯誤可確保良好的終端使用者體驗，並限制終端使用者需要登入的次數。

在本文中，我們會針對 ADAL 所支援的每個平台來探討特定案例，以及說明您的應用程式如何才能正確地處理每個案例。 錯誤指引會根據 ADAL API 所提供的權杖取得模式，分成兩個更廣泛的類別：

- **AcquireTokenSilent**：用戶端嘗試以無訊息方式 (無 UI) 取得權杖，但可能會在 ADAL 失敗時跟著失敗。 
- **AcquireToken**：用戶端可以嘗試無訊息擷取，但也可以執行需要登入的互動式要求。

> [!TIP]
> 使用 ADAL 和 Azure AD 時，最好能記錄所有錯誤和例外狀況。 記錄不只有助於了解應用程式的整體健康情況，在進行更廣泛的問題偵錯時也十分重要。 雖然您的應用程式可以從某些錯誤中復原，但這些錯誤可能暗示有更廣泛的設計問題，且需要變更程式碼才能解決。 
> 
> 實作本文件涵蓋的錯誤狀況時，您必須記錄錯誤碼和描述 (原因如先前所述)。 請參閱[錯誤和記錄參考](#error-and-logging-reference)，以取得記錄程式碼的範例。 
>

## <a name="acquiretokensilent"></a>AcquireTokenSilent

AcquireTokenSilent 會嘗試取得可保證終端使用者不會看到使用者介面 (UI) 的權杖。 在幾種情況下，無訊息擷取可能會失敗，且需透過互動式要求或預設處理常式來處理。 在以下幾節中，我們會探討何時及如何運用每個案例的細節。

有一組由作業系統產生的錯誤，其可能需要應用程式特有的錯誤處理。 如需詳細資訊，請參閱[錯誤和記錄參考](#error-and-logging-reference)中的「作業系統錯誤」一節。 

### <a name="application-scenarios"></a>應用程式案例

- [原生用戶端](developer-glossary.md#native-client)應用程式 (iOS、Android、.NET 桌面或 Xamarin)
- 呼叫[資源](developer-glossary.md#resource-server) (.NET) 的 [Web 用戶端](developer-glossary.md#web-client)應用程式

### <a name="error-cases-and-actionable-steps"></a>錯誤案例和可採取動作的步驟

基本上，AcquireTokenSilent 錯誤有兩種情況：

| 案例 | 說明 |
|------|-------------|
| **案例 1**：可透過互動式登入解決錯誤 | 若為缺少有效權杖所造成的錯誤，則必須有互動式要求。 具體而言，快取查閱及無效/過期的重新整理權杖需要 AcquireToken 呼叫才能解決。<br><br>在這些案例中，終端使用者必須在提示下登入。 應用程式可選擇在終端使用者互動之後 (例如點擊登入按鈕)，立即執行互動式要求，或是稍後再執行。 這項選擇取決於應用程式所需的行為。<br><br>請參閱下節中的程式碼，了解此特定案例和其診斷錯誤。|
| **案例 2**：無法透過互動式登入解決錯誤 | 對於網路和暫時性/暫存錯誤或其他失敗，執行互動式 AcquireToken 要求並無法解決問題。 不必要的互動式登入提示也可能讓終端使用者不耐煩。 對於大部分有關 AcquireTokenSilent 失敗的錯誤，ADAL 會自動嘗試一次重試。<br><br>用戶端應用程式也可以稍後嘗試重試，但何時及如何操作，則取決於應用程式行為和所需的使用者體驗。 例如，應用程式可以在幾分鐘後或回應某些終端使用者動作之後，執行 AcquireTokenSilent 重試。 立即重試將會導致應用程式進行節流處理，不該嘗試這麼做。<br><br>後續具有相同錯誤的重試失敗並不表示用戶端應使用 AcquireToken 執行互動式要求，因為這無法解決錯誤。<br><br>請參閱下節中的程式碼，了解此特定案例和其診斷錯誤。 |

### <a name="net"></a>.NET

下列指引提供搭配 ADAL 方法的錯誤處理範例： 

- acquireTokenSilentAsync(…)
- acquireTokenSilentSync(…) 
- [已淘汰] acquireTokenSilent(…)
- [已淘汰] acquireTokenByRefreshToken(…) 

您的程式碼實作方式如下所示：

```csharp
try{
    AcquireTokenSilentAsync(…);
} 

catch (AdalSilentTokenAcquisitionException e) {
    // Exception: AdalSilentTokenAcquisitionException
    // Caused when there are no tokens in the cache or a required refresh failed. 

    // Action: Case 1, resolvable with an interactive request. 
} 

catch(AdalServiceException e) {
    // Exception: AdalServiceException 
    // Represents an error produced by the STS. 
    // e.ErrorCode contains the error code and description, which can be used for debugging. 
    // NOTE: Do not code a dependency on the contents of the error description, as it can change over time.

    // Action: Case 2, not resolvable with an interactive request.
    // Attempt retry after a timed interval or user action.
} 
    
catch (AdalException e) {
    // Exception: AdalException 
    // Represents a library exception generated by ADAL .NET. 
    // e.ErrorCode contains the error code. 

    // Action: Case 2, not resolvable with an interactive request.
    // Attempt retry after a timed interval or user action.
    // Example Error: network_not_available, default case.
}
```

### <a name="android"></a>Android

下列指引提供搭配 ADAL 方法的錯誤處理範例： 

- acquireTokenSilentSync(…)
- acquireTokenSilentAsync(...)
- [已淘汰] acquireTokenSilent(…)

您的程式碼實作方式如下所示：

```java
// *Inside callback*
public void onError(Exception e) {

    if (e instanceof AuthenticationException) {
        // Exception: AdalException
        // Represents a library exception generated by ADAL Android.
        // Error Code: e.getCode().

        // Errors: ADALError.ERROR_SILENT_REQUEST,
        // ADALError.AUTH_REFRESH_FAILED_PROMPT_NOT_ALLOWED,
        // ADALError.INVALID_TOKEN_CACHE_ITEM
        // Description: Request failed due to no tokens in
        // cache or failed a required refresh. 

        // Action: Case 1, resolvable with an interactive request. 

        // Action: Case 2, not resolvable with an interactive request.
        // Attempt retry after a timed interval or user action.
        // Example Errors: default case,
        // DEVICE_CONNECTION_IS_NOT_AVAILABLE, 
        // BROKER_AUTHENTICATOR_ERROR_GETAUTHTOKEN,
    }
}
```

### <a name="ios"></a>iOS

下列指引提供搭配 ADAL 方法的錯誤處理範例： 

- acquireTokenSilentWithResource(…)

您的程式碼實作方式如下所示：

```objc
[context acquireTokenSilentWithResource:[ARGS], completionBlock:^(ADAuthenticationResult *result) {
    if (result.status == AD_FAILED) {
        if ([error.domain isEqualToString:ADAuthenticationErrorDomain]){
            // Exception: AD_FAILED 
            // Represents a library error generated by ADAL Objective-C.
            // Error Code: result.error.code

            // Errors: AD_ERROR_SERVER_REFRESH_TOKEN_REJECTED, AD_ERROR_CACHE_NO_REFRESH_TOKEN
            // Description: No tokens in cache or failed a required token refresh failed. 
            // Action: Case 1, resolvable with an interactive request. 

            // Error: AD_ERROR_CACHE_MULTIPLE_USERS
            // Description: There was ambiguity in the silent request resulting in multiple cache items.
            // Action: Special Case, application should perform another silent request and specify the user using ADUserIdentifier. 
            // Can be caused in cases of a multi-user application. 

            // Action: Case 2, not resolvable with an interactive request.
            // Attempt retry after some time or user action.
            // Example Errors: default case,
            // AD_ERROR_CACHE_BAD_FORMAT
        }
    }
}]
```

## <a name="acquiretoken"></a>AcquireToken

AcquireToken 是用來取得權杖的預設 ADAL 方法。 在需要使用者身分識別的情況下，AcquireToken 會嘗試先以無訊息模式取得權杖，然後視需要顯示 UI (除非通過 PromptBehavior.Never)。 在需要應用程式識別碼的情況下，AcquireToken 會嘗試取得權杖，但不會顯示 UI，因為沒有終端使用者。 

處理 AcquireToken 錯誤時，錯誤處理會取決於平台和應用程式嘗試達到的情況。 

作業系統也可能產生一組錯誤，其需要的錯誤處理取決於特定應用程式。 如需詳細資訊，請參閱[錯誤和記錄參考](#error-and-logging-reference)中的「作業系統錯誤」。 

### <a name="application-scenarios"></a>應用程式案例

- 原生用戶端應用程式 (iOS、Android、.NET Desktop 或 Xamarin)
- 呼叫資源 API (.NET) 的 Web 應用程式
- 單頁應用程式 (JavaScript)
- 服務對服務應用程式 (.NET、Java)
  - 所有案例 (包括代表性案例)
  - 代表性特有案例

### <a name="error-cases-and-actionable-steps-native-client-applications"></a>錯誤案例和可採取動作的步驟：原生用戶端應用程式

如果您正在建置原生用戶端應用程式，則需考量幾個錯誤處理案例，而這些案例與網路問題、暫時性失敗和其他平台特有錯誤相關。 在大部分情況下，應用程式不應該執行立即重試，而是等候會產生登入提示的終端使用者互動。 

在幾個特殊案例中，一次重試即可解決此問題。 例如，使用者必須啟用裝置上的資料時，或在第一次失敗後完成 Azure AD 訊息代理程式的下載時。 

在失敗的案例中，應用程式可顯示 UI，讓使用者執行可提示重試的某些互動。 比方說，如果裝置因為離線錯誤而發生失敗，[請嘗試重新登入] 按鈕會提示進行 AcquireToken 重試，而不是立即重試失敗的作業。 

原生應用程式中的錯誤處理可以依據兩種案例來定義：

|  |  |
|------|-------------|
| **案例 1**：<br>無法重試的錯誤 (大部分的案例) | 1.請勿嘗試立即重試。 根據可叫用重試的特定錯誤顯示終端使用者 UI ([請嘗試重新登入]、[請下載 Azure AD 訊息代理程式的應用程式] 等)。 |
| **案例 2**：<br>可重試的錯誤 | 1.執行一次重試，因為終端使用者可能已進入可招致成功的狀態。<br><br>2.如果重試失敗，請根據可叫用重試的特定錯誤顯示終端使用者 UI ([請嘗試重新登入]、[請下載 Azure AD 訊息代理程式的應用程式] 等)。 |

> [!IMPORTANT]
> 如果使用者帳戶透過無訊息呼叫傳遞給 ADAL，但失敗了，則後續的互動式要求可讓終端使用者使用不同帳戶進行登入。 透過使用者帳戶成功執行 AcquireToken 後，應用程式必須確認登入的使用者與應用程式的本機使用者物件相符。 不相符並不會產生例外狀況 (Objective C 除外)，但如果在驗證要求之前，本機已知某個使用者 (例如失敗的無訊息呼叫)，則應考量不相符的情況。
>

#### <a name="net"></a>.NET

下列指引提供搭配所有有訊息 AcquireToken(…) ADAL 方法的錯誤處理範例，但以下除外： 

- AcquireTokenAsync(…, IClientAssertionCertification, …)
- AcquireTokenAsync(…,ClientCredential, …)
- AcquireTokenAsync(…,ClientAssertion, …)
- AcquireTokenAsync(…,UserAssertion,…)   

您的程式碼實作方式如下所示：

```csharp
try {
    AcquireTokenAsync(…);
} 
    
catch(AdalServiceException e) {
    // Exception: AdalServiceException 
    // Represents an error produced by the STS. 
    // e.ErrorCode contains the error code and description, which can be used for debugging. 
    // NOTE: Do not code a dependency on the contents of the error description, as it can change over time.
    
    // Design time consideration: Certain errors may be caused at development and exposed through this exception. 
    // Looking inside the description will give more guidance on resolving the specific issue. 

    // Action: Case 1: Non-Retryable 
    // Do not perform an immediate retry. Only retry after user action. 
    // Example Errors: default case

    } 

catch (AdalException e) {
    // Exception: AdalException 
    // Represents a library exception generated by ADAL .NET.
    // e.ErrorCode contains the error code

    // Action: Case 1, Non-Retryable 
    // Do not perform an immediate retry. Only retry after user action. 
    // Example Errors: network_not_available, default case
}
```

> [!NOTE]
> ADAL.NET 有額外的考量，因為其支援行為類似 AcquireTokenSilent 的 PromptBehavior.Never。
>

下列指引提供搭配 ADAL 方法的錯誤處理範例： 

- acquireToken(…, PromptBehavior.Never)

您的程式碼實作方式如下所示：

```csharp
    try {acquireToken(…, PromptBehavior.Never);
    } 

catch(AdalServiceException e) {
    // Exception: AdalServiceException represents 
    // Represents an error produced by the STS. 
    // e.ErrorCode contains the error code and description, which can be used for debugging. 
    // NOTE: Do not code a dependency on the contents of the error description, as it can change over time.

    // Action: Case 1: Non-Retryable 
    // Do not perform an immediate retry. Only retry after user action. 
    // Example Errors: default case

} catch (AdalException e) {
    // Error Code: e.ErrorCode == "user_interaction_required"
    // Description: user_interaction_required indicates the silent request failed 
    // in a way that's resolvable with an interactive request.
    // Action: Resolvable with an interactive request. 

    // Action: Case 1, Non-Retryable 
    // Do not perform an immediate retry. Only retry after user action. 
    // Example Errors: network_not_available, default case
}
```

#### <a name="android"></a>Android

下列指引提供搭配所有有訊息 AcquireToken(…) ADAL 方法的錯誤處理範例。 

您的程式碼實作方式如下所示：

```java
AcquireTokenAsync(…);

// *Inside callback*
public void onError(Exception e) {
    if (e instanceof AuthenticationException) {
        // Exception: AdalException 
        // Represents a library exception generated by ADAL Android.
        // Error Code: e.getCode();

        // Error: ADALError.BROKER_APP_INSTALLATION_STARTED
        // Description: Broker app not installed, user will be prompted to download the app. 

        // Action: Case 2, Retriable Error 
        // Perform a single retry. If that fails, only try again after user action. 

        // Action: Case 1, Non-Retriable 
        // Do not perform an immediate retry. Only retry after user action. 
        // Example Errors: default case, DEVICE_CONNECTION_IS_NOT_AVAILABLE
    }
}
```

#### <a name="ios"></a>iOS

下列指引提供搭配所有有訊息 AcquireToken(…) ADAL 方法的錯誤處理範例。 

您的程式碼實作方式如下所示：

```objc
[context acquireTokenWithResource:[ARGS], completionBlock:^(ADAuthenticationResult *result) {
    if (result.status == AD_FAILED) {
        if ([error.domain isEqualToString:ADAuthenticationErrorDomain]){
            // Exception: AD_FAILED 
            // Represents a library error generated by ADAL ObjC.
            // Error Code: result.error.code 

            // Error: AD_ERROR_SERVER_WRONG_USER
            // Description: App passed a user into ADAL and the end user signed in with a different account. 
            // Action: Case 1, Non-retriable (as is) and up to the application on how to handle this case. 
            // It can attempt a new request without specifying the user, or use UI to clarify the user account to sign in. 

            // Action: Case 1, Non-Retriable 
            // Do not perform an immediate retry. Only retry after user action. 
            // Example Errors: default case
        }
    }
}]
```

### <a name="error-cases-and-actionable-steps-web-applications-that-call-a-resource-api-net"></a>錯誤案例和可採取動作的步驟：呼叫資源 API (.NET) 的 Web 應用程式

如果您要建置可使用資源授權碼取得權杖的 .NET Web 應用程式，唯一需要的程式碼就是適用於一般案例的預設處理常式。 

下列指引提供搭配 ADAL 方法的錯誤處理範例： 

- AcquireTokenByAuthorizationCodeAsync(…)

您的程式碼實作方式如下所示：

```csharp
try {
    AcquireTokenByAuthorizationCodeAsync(…);
} 

catch (AdalException e) {
    // Exception: AdalException
    // Represents a library exception generated by ADAL .NET.
    // Error Code: e.ErrorCode

    // Action: Do not perform an immediate retry. Only try again after user action or wait until much later. 
    // Example Errors: default case
}
```

### <a name="error-cases-and-actionable-steps-single-page-applications-adaljs"></a>錯誤案例和可採取動作的步驟：單頁應用程式 (adal.js)

如果您要使用 adal.js 與 AcquireToken 建置單頁應用程式，錯誤處理程式碼則與一般無訊息呼叫類似。 尤其在 adal.js 中，AcquireToken 永遠不會顯示 UI。 

失敗的 AcquireToken 案例如下所示：

|  |  |
|------|-------------|
| **案例 1**：<br>可透過互動式要求解決 | 1.如果 login() 失敗，請勿執行立即重試。 只在使用者動作提示重試之後重試。|
| **案例 2**：<br>無法透過互動式要求解決。 錯誤可重試。 | 1.執行一次重試，因為終端使用者可能已進入可招致成功的狀態。<br><br>2.如果重試失敗，請根據可叫用重試的特定錯誤，向終端使用者顯示動作 ([請嘗試重新登入])。 |
| **案例 3**：<br>無法透過互動式要求解決。 錯誤不可重試。 | 1.請勿嘗試立即重試。 請根據可叫用重試的特定錯誤，向終端使用者顯示動作 ([請嘗試重新登入])。 |

您的程式碼實作方式如下所示：

```javascript
AuthContext.acquireToken(…, function(error, errorDesc, token) {
    if (error || errorDesc) {
        // Represents any token acquisition failure that occurred. 
        // Error Code: error.indexOf("<ERROR_STRING>")

        // Errors: if (error.indexOf("interaction_required"))
        //         if (error.indexOf("login required"))
        // Description: ADAL wasn't able to silently acquire a token because of expire or fresh session. 
        // Action: Case 1, Resolvable with an interactive login() request. 

        // Error: if (error.indexOf("Token Renewal Failed")) 
        // Description: Timeout when refreshing the token.
        // Action: Case 2, Not resolvable interactively, error is retriable.
        // Perform a single retry. Only try again after user action.

        // Action: Case 3, Not resolvable interactively, error is not retriable. 
        // Do not perform an immediate retry. Only retry after user action.
        // Example Errors: default case
    }
}
```

### <a name="error-cases-and-actionable-steps-service-to-service-applications-net-only"></a>錯誤案例和可採取動作的步驟：服務對服務應用程式 (僅限.NET)

如果您要建置使用 AcquireToken 的服務對服務應用程式，則程式碼必須處理幾個關鍵錯誤。 解決錯誤的唯一辦法是將錯誤傳回呼叫應用程式 (適用於代表性案例)，或套用重試策略。 

#### <a name="all-scenarios"></a>所有案例

對於「所有」服務對服務應用程式案例 (包括代表性案例)：

- 請勿嘗試立即重試。 ADAL 會針對某些失敗的要求嘗試一次重試。 
- 只有在使用者或應用程式動作提示重試之後，才繼續重試。 例如，依設定的間隔運作的精靈應用程式必須等到下一個間隔才能重試。

下列指引提供搭配 ADAL 方法的錯誤處理範例： 

- AcquireTokenAsync(…, IClientAssertionCertification, …)
- AcquireTokenAsync(…,ClientCredential, …)
- AcquireTokenAsync(…,ClientAssertion, …)
- AcquireTokenAsync(…,UserAssertion, …)

您的程式碼實作方式如下所示：

```csharp
try {
    AcquireTokenAsync(…);
} 

catch (AdalException e) {
    // Exception: AdalException
    // Represents a library exception generated by ADAL .NET.
    // Error Code: e.ErrorCode

    // Action: Do not perform an immediate retry. Only try again after user action (if applicable) or wait until much later. 
    // Example Errors: default case
}  
```

#### <a name="on-behalf-of-scenarios"></a>代表性案例

對於「代表性」服務對服務應用程式案例。

下列指引提供搭配 ADAL 方法的錯誤處理範例： 

- AcquireTokenAsync(…, UserAssertion, …)

您的程式碼實作方式如下所示：

```csharp
try {
AcquireTokenAsync(…);
} 

catch (AdalServiceException e) {
    // Exception: AdalServiceException 
    // Represents an error produced by the STS. 
    // e.ErrorCode contains the error code and description, which can be used for debugging. 
    // NOTE: Do not code a dependency on the contents of the error description, as it can change over time.

    // Error: On-Behalf-Of Error Handler
    if (e.ErrorCode == "interaction_required") {
        // Description: The client needs to perform some action due to a config from admin. 
        // Action: Capture `claims` parameter inside ex.InnerException.InnerException.
        // Generate HTTP error 403 with claims, throw back HTTP error to client.
        // Wait for client to retry. 
    }
} 
        
catch (AdalException e) {
    // Exception: AdalException 
    // Represents a library exception generated by ADAL .NET.
    // Error Code: e.ErrorCode

    // Action: Do not perform an immediate retry. Only try again after user action (if applicable) or wait until much later. 
    // Example Error: default case
}
```

我們已建置[完整範例](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca)來示範此案例。

## <a name="error-and-logging-reference"></a>錯誤和記錄參考

### <a name="logging-personal-identifiable-information-pii--organizational-identifiable-information-oii"></a>記錄個人識別資訊 (PII) 與組織識別資訊 (OII)
根據預設，ADAL 記錄不會擷取或記錄任何 PII 或 OII。 文件庫可讓應用程式開發人員透過記錄器類別的 setter 來開啟此選項。 藉由開啟 PII 或 OII，應用程式會負責安全無虞地處理高敏感性資料，並遵守所有法規需求。

### <a name="net"></a>.NET

#### <a name="adal-library-errors"></a>ADAL 程式庫錯誤

若要探索特定的 ADAL 錯誤，[azure-activedirectory-library-for-dotnet 存放庫](https://github.com/AzureAD/azure-activedirectory-library-for-dotnet/blob/8f6d560fbede2247ec0e217a21f6929d4375dcaa/src/ADAL.PCL/Utilities/Constants.cs#L58)中的原始程式碼最適合作為錯誤參考。

#### <a name="guidance-for-error-logging-code"></a>錯誤記錄程式碼的指引

ADAL.NET 記錄會因所使用的平台而有所不同。 請參閱[記錄 wiki](https://github.com/AzureAD/azure-activedirectory-library-for-dotnet/wiki/Logging-in-ADAL.Net)，以了解如何啟用記錄功能的程式碼。

### <a name="android"></a>Android

#### <a name="adal-library-errors"></a>ADAL 程式庫錯誤

若要探索特定的 ADAL 錯誤，[azure-activedirectory-library-for-android 存放庫](https://github.com/AzureAD/azure-activedirectory-library-for-android/blob/dev/adal/src/main/java/com/microsoft/aad/adal/ADALError.java#L33)中的原始程式碼最適合作為錯誤參考。

#### <a name="operating-system-errors"></a>作業系統錯誤

Android OS 錯誤會透過 ADAL 中的 AuthenticationException 公開，並可識別為 "SERVER_INVALID_REQUEST"，而且可以透過錯誤描述進一步細分。 

如需常見錯誤的完整清單，以及應用程式或終端使用者遇到這些錯誤時所要採取的步驟，請參閱 [ADAL Android Wiki](https://github.com/AzureAD/azure-activedirectory-library-for-android/wiki)。 

#### <a name="guidance-for-error-logging-code"></a>錯誤記錄程式碼的指引

```java
// 1. Configure Logger
Logger.getInstance().setExternalLogger(new ILogger() {    
    @Override   
    public void Log(String tag, String message, String additionalMessage, LogLevel level, ADALError errorCode) { 
    // …
    // You can write this to logfile depending on level or errorcode. 
    writeToLogFile(getApplicationContext(), tag +":" + message + "-" + additionalMessage);    
    }
}

// 2. Set the log level
Logger.getInstance().setLogLevel(Logger.LogLevel.Verbose);

// By default, the `Logger` does not capture any PII or OII

// PII or OII will be logged
Logger.getInstance().setEnablePII(true);

// To STOP logging PII or OII, use the following setter
Logger.getInstance().setEnablePII(false);


// 3. Send logs to logcat.
adb logcat > "C:\logmsg\logfile.txt";
```

### <a name="ios"></a>iOS

#### <a name="adal-library-errors"></a>ADAL 程式庫錯誤

若要探索特定的 ADAL 錯誤，[azure-activedirectory-library-for-objc 存放庫](https://github.com/AzureAD/azure-activedirectory-library-for-objc/blob/dev/ADAL/src/ADAuthenticationError.m#L295)中的原始程式碼最適合作為錯誤參考。

#### <a name="operating-system-errors"></a>作業系統錯誤

使用者使用 Web 檢視時可能會在登入時造成 iOS 錯誤 (驗證特性)。 這可能是由 SSL 錯誤、逾時或網路錯誤等原因所造成：

- 對於權利共用，登入不具持續性，且快取呈現空白。 將下列程式碼行新增至金鑰鏈可以解決問題：`[[ADAuthenticationSettings sharedInstance] setSharedCacheKeychainGroup:nil];`
- 對於 NsUrlDomain 錯誤集，動作會因應用程式邏輯而有所不同。 請參閱 [NSURLErrorDomain 參考文件](https://developer.apple.com/documentation/foundation/nsurlerrordomain#declarations)，以了解可以處理的特定執行個體。
- 請參閱 [ADAL Obj-C 常見問題](https://github.com/AzureAD/azure-activedirectory-library-for-objc#adauthenticationerror)，以取得由 ADAL Objective-C 小組負責維護的常見錯誤清單。

#### <a name="guidance-for-error-logging-code"></a>錯誤記錄程式碼的指引

```objc
// 1. Enable NSLogging
[ADLogger setNSLogging:YES];

// 2. Set the log level (if you want verbose)
[ADLogger setLevel:ADAL_LOG_LEVEL_VERBOSE];

// 3. Set up a callback block to simply print out
[ADLogger setLogCallBack:^(ADAL_LOG_LEVEL logLevel, NSString *message, NSString *additionalInformation, NSInteger errorCode, NSDictionary *userInfo) {
     NSString* log = [NSString stringWithFormat:@"%@ %@", message, additionalInformation];    
     NSLog(@"%@", log);
}];
```

### <a name="guidance-for-error-logging-code---javascript"></a>錯誤記錄程式碼的指引 - JavaScript 

```javascript
0: Error1: Warning2: Info3: Verbose
window.Logging = {
    level: 3,
    log: function (message) {
        console.log(message);
    }
};
```
## <a name="related-content"></a>相關內容

* [Azure AD 開發人員指南][AAD-Dev-Guide]
* [Azure AD 驗證程式庫][AAD-Auth-Libraries]
* [Azure AD 驗證案例][AAD-Auth-Scenarios]
* [整合應用程式與 Azure Active Directory][AAD-Integrating-Apps]

使用下方的註解區段來提供意見反應，並協助我們改善及設計我們的內容。

[![登入按鈕][AAD-Sign-In]][AAD-Sign-In]
<!--Reference style links --> [AAD-Auth-Libraries]: ./active-directory-authentication-libraries.md [AAD-Auth-Scenarios]:authentication-scenarios.md [AAD-Dev-Guide]:azure-ad-developers-guide.md [AAD-Integrating-Apps]:quickstart-v1-integrate-apps-with-azure-ad.md [AZURE-portal]: https://portal.azure.com

<!--Image references-->
[AAD-Sign-In]:./media/active-directory-devhowto-multi-tenant-overview/sign-in-with-microsoft-light.png

