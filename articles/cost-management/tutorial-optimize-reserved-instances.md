---
title: 教學課程 - 在 Azure 中使用 Cloudyn 將保留執行個體成本最佳化 | Microsoft Docs
description: 在本教學課程中，您將了解如何將 Azure 和 Amazon Web Services (AWS) 的保留執行個體成本最佳化。
services: cost-management
keywords: ''
author: bandersmsft
ms.author: banders
ms.date: 10/17/2018
ms.topic: tutorial
ms.service: cost-management
ms.custom: ''
manager: dougeby
ms.openlocfilehash: e705a0f57b598eb60932ca1056131cedc1416ffc
ms.sourcegitcommit: b4a46897fa52b1e04dd31e30677023a29d9ee0d9
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/17/2018
ms.locfileid: "49394441"
---
<!-- Intent: As a cloud-consuming administrator, I need to ensure that my reserved instances are optimized for cost and usage
-->

# <a name="tutorial-optimize-reserved-instances"></a>教學課程：最佳化保留執行個體

在本教學課程中，您會了解 Cloudyn 如何協助您將保留執行個體成本和 Azure 和 Amazon Web Services (AWS) 使用率最佳化。 採用任一個雲端服務提供者的保留執行個體是對長期合約所做的承諾，您會在合約中承諾未來使用 VM 的預付款。 而且，相較於標準按使用次數付費的 VM 定價模型，它可能會省下很可觀的成本。 只有充分使用保留執行個體的容量時，才能實現潛在的節省。

本教學課程說明 Cloudyn 如何支援 Azure 和 AWS 保留執行個體 (RI)。 此外也說明如何將保留執行個體的成本最佳化。 主要方式是確保充分利用您的保留。 在本教學課程中，您將：

> [!div class="checklist"]
> * 了解 Azure RI 成本
> * 了解 RI 的權益
> * 將 Azure RI 成本最佳化
> * 檢視 RI 成本
> * 評估 Azure AI 成本效益
> * 將 AWS RI 成本最佳化
> * 購買建議的 RI
> * 修改未使用的保留

如果您沒有 Azure 訂用帳戶，請在開始前建立[免費帳戶](https://azure.microsoft.com/free/?WT.mc_id=A261C142F)。

## <a name="prerequisites"></a>必要條件

- 您必須具有 Azure 帳號。
- 您必須具有 Cloudyn 的試用版註冊或付費訂用帳戶。
- 您必須已購買 Azure 或 AWS 中的 RI。

## <a name="understand-azure-ri-costs"></a>了解 Azure RI 成本

當您購買 Azure VM 保留執行個體時，您需支付未來使用的預付款。 預付款涵蓋未來使用 VM 的成本：

- 屬於特定類型
- 在特定區域中
- 為期一或三年的期限
- 用完所購買的 VM 數量。

您可以在 Azure 入口網站中的[保留](https://portal.azure.com/#blade/Microsoft_Azure_Reservations/ReservationsBrowseBlade)檢視您購買的 Azure VM 保留執行個體。

「Azure VM 保留執行個體」一詞只適用於定價模型。 它完全不會改變您正在執行的 VM。 這是 Azure 特有的術語，「保留執行個體」或「保留」是更為普遍的稱呼。 您購買的保留執行個體不適用於到特定的 VM - 它們適用於任何相符的 VM。 例如，在您為所購買保留選擇的區域中執行之 VM 類型的保留。

已購買的保留執行個體只適用於基本硬體。 它們不涵蓋 VM 的軟體授權。 例如，您可能會保留一個執行個體，並有一個執行 Windows 的相符 VM。 保留執行個體只涵蓋 VM 的基本成本。 在此範例中，您需支付任何必要 Windows 授權的完整價格。 若要取得作業系統或在 VM 上執行之其他軟體的折扣，您應考慮使用 [Azure Hybrid Benefit](https://azure.microsoft.com/pricing/hybrid-benefit)。 如同保留執行個體為基底 VM 提供的折扣，Hybrid Benefit 可為您的軟體授權提供類似的折扣類型。

保留執行個體的使用率不會直接影響成本。 換句話說，以 100 % CPU 使用率或 0% CPU 使用率執行 VM 的效果相同：您要針對 VM 配置 (而非其實際使用率) 預先付費。

在下圖中，我們可看到標準隨選 VM 使用量與保留執行個體相關成本有何關聯：

![隨選成本與保留執行個體成本](./media/tutorial-optimize-reserved-instances/azure01.png)



紅色長條顯示購買保留執行個體的累計成本。 您只需支付一次性費用。 VM 可免費使用。 藍色長條顯示以預付方案或隨選定價模型執行之相同 VM 的累計成本。 在 VM 使用量的第七個月和第八個月之間有「損益平衡點」。 在此範例中，您從第八個月起開始省錢。

## <a name="benefits-of-ris"></a>RI 的權益

每項保留執行個體購買會適用於特定大小和位置的 VM。 例如，如下圖所示在美國西部位置執行的 D2s\_v3：

![Azure 保留執行個體詳細資料](./media/tutorial-optimize-reserved-instances/azure02.png)

當 VM 執行足夠時數以達到保留損益平衡點時，購買保留執行個體就有幫助。 VM 必須符合保留執行個體的大小和位置。 例如，前一個圖表中的損益平衡點大約在第七個月又半個月的地方。 因此，當符合保留的 VM 執行至少 7.5 個月 \* 30 天 \* 24 小時 = 5,400 小時，購買就有幫助。 如果相符的 VM 執行時間少於 5,400 小時，則保留比預付型方案更加昂貴。

每個 VM 大小和每個位置的損益平衡點可能有所不同。 它也會取決於您交涉的 VM 預付型方案價格。 進行購買之前，您應該檢查您的案例適用的損益平衡點。

您在購買保留時所要考量的另一點就是保留執行個體範圍。 範圍可決定是否共用保留權益，或者該權益是否適用於特定的訂用帳戶。 共用的保留執行個體會隨機套用於第一個找到之相符 VM 的所有訂用帳戶。

共用的購買範圍最有彈性，建議盡可能使用此範圍。 使用共用範圍時，利用所有保留執行個體的機會明顯較大。 不過，當訂用帳戶的擁有者支付保留執行個體時，除了透過單一訂用帳戶範圍購買該執行個體以外，他們沒有任何選擇。

## <a name="optimize-azure-ri-costs"></a>將 Azure RI 成本最佳化

Cloudyn 可透過下列方式支援保留執行個體和 Hybrid Benefit：

- 顯示與定價模型相關聯的成本
- 追蹤 RI 使用量
- 評估 RI 影響
- 根據您的原則配置 RI 成本

在購買保留執行個體之前，您應採取的第一個動作就是評估 RI 購買的影響：

- 您將花費多少成本？
- 您將省下多少成本？
- 損益平衡點為何？

「保留執行個體購買影響」報告有助於回答這些問題。

## <a name="assess-azure-ri-cost-effectiveness"></a>評估 Azure AI 成本效益

在 Cloudyn 入口網站中，瀏覽至 [最佳化工具] > [RI 比較]，然後選取 [保留執行個體購買影響]。

在「保留執行個體購買影響」報告中，選取 VM 大小 (執行個體類型)、位置 (區域)、保留期間、數量和預期的執行階段。 然後您可以評估購買是否會節省成本。

例如，如果您針對美國東部 DS1\_v2 類型的 VM 購買保留，而且它會一整年全天候執行，您每年就可以節省 $369.48 美元。 損益平衡點位於第五個月。 請見下圖：

![Azure 保留執行個體的損益平衡點](./media/tutorial-optimize-reserved-instances/azure03.png)

不過，如果它僅執行 50% 的時間，損益平衡點會位於第 10 個月，而且每年只能節省 $49.74 美元。 在此範例中，針對該該執行個體類型購買保留，可能沒有好處。 請見下圖：

![Azure 中的損益平衡點](./media/tutorial-optimize-reserved-instances/azure04.png)

## <a name="view-ri-costs"></a>檢視 RI 成本

當您購買保留時，您會進行一次性付款。 在 Cloudyn 中，有兩種方式可檢視付款：

- 實際成本
- 分攤成本

### <a name="actual-reserved-instance-cost"></a>實際的保留執行個體成本

「實際成本分析」和「一段時間的分析」報告會顯示您針對保留所支付的完整金額 (從購買月份開始計算)。 這些報告可協助您查看一段期間的實際費用。

瀏覽至 [成本] > [成本分析] > 在 Cloudyn 入口網站中，然後選取 [實際成本分析] 或 [一段時間的實際成本]。 接著設定篩選條件。 例如，只篩選 Azure VM/服務，並依照資源類型和價格模型進行分組。 請見下圖：

![保留執行個體的實際成本](./media/tutorial-optimize-reserved-instances/azure05.png)

您可以依照服務 (此範例中的 **Azure/VM**) 篩選，以及依照 [價格模型] 和 [資源類型] 分組，如下圖所示：

![實際成本報告群組和篩選條件](./media/tutorial-optimize-reserved-instances/azure06.png)

您也可以分析您所進行的付款類型，例如一次性費用、使用費用，以及授權費用。

### <a name="amortized-reserved-instance-cost"></a>分攤的保留執行個體成本

當您購買 RI 時，您需支付在購買月份出現的預付費用。 該費用不會出現在您後續的發票中。 因此，查看您的每月使用量可能會產生誤解。 您的月份確切成本是每月使用量，加上任何先前所進行之一次性費用的相稱 (分攤) 部分。 「分攤成本」報告可協助您了解真相。

取得保留一次性費用並將它分攤於保留期間，即可計算分攤的保留執行個體成本。 在「實際成本」報告中，一次性費用會出現在購買保留的月份中。 每日及每月費用不會出現在部署的實際成本中。 「分攤成本」報告會顯示一段時間的實際部署成本。  「分攤成本」報告是查看真實成本趨勢的唯一方式。 它也是預估未來費用的唯一方式。

在「實際成本」報告中，您可看到在 11 月 16 日花費 $747 美元的 RI 購買突然增加。 在「分攤成本」報告中 (請見下圖)，11 月 16 日有部分的日成本。 從 11 月 17 日開始，您看到分攤的 RI 成本為 $747/365 = $2.05 美元。 順帶一提，您也可注意到購買的保留並未使用，因此您可藉由將它切換成不同的 VM 大小來進行最佳化。

若要進行檢視，請瀏覽至 [成本] > [成本分析]，然後選取 [分攤成本分析] 或 [一段時間的分攤成本]。

![分攤的保留執行個體成本](./media/tutorial-optimize-reserved-instances/azure07.png)

## <a name="optimize-aws-ri-costs"></a>將 AWS RI 成本最佳化

保留執行個體是一項未兌現的承諾。 當您持續使用 VM 時，保留執行個體因為比隨選執行個體更加便宜，所以很實用。 不過，必須充分使用它們。 承諾就是在定義的期間 (一或三年) 內使用資源 (通常是 VM)。 當您做出購買承諾時，您需透過預先支付保留的資源。 不過，您不一定會完全使用您在保留中所承諾的內容。

例如，您可能會評估您的環境，並判斷您去年有 20 個持續執行的標準 D2 執行個體。 您可以為其購買保留，並可能省下大量金錢。 在不同的範例中，您可能會承諾該年度使用 10 個 MA4 執行個體。 但是，您至今可能只使用了五個。 這兩個範例都說明 RI 的使用效率不足。 使用 Cloudyn 最佳化報告將保留執行個體成本最佳化的方式有兩種：

- 檢閱根據您過去的使用量所提出的購買建議，了解您可購買的項目
- 修改未使用的保留

您可使用「EC2 RI 購買建議」和「EC2 目前未使用的保留」報告，來改善您的保留執行個體使用量和成本。

## <a name="buy-recommended-ris"></a>購買建議的 RI

Cloudyn 會比較隨選執行個體使用量與可能的保留執行個體。 當它找到可能的節省時，其建議就會顯示在「EC2 購買建議」報告中。

在入口網站頂端的 [報告] 功能表上，按一下 [最佳化工具] > [定價最佳化] > [EC2 RI 購買建議]。

下圖顯示報告中的購買建議。

![購買建議](./media/tutorial-optimize-reserved-instances/aws01.png)

在此範例中，Cloudyn\_A 帳戶有 32 項保留執行個體購買建議。 如果您遵循所有購買建議，您每年可能省下 $137,770 美元。 請記住，Cloudyn 所提供的購買建議假設執行中工作負載的使用量維持一致。

若要檢視可解釋為何建議每項購買的詳細資訊，請按一下 [理由] 下方的加號 ( **+**)。 以下是清單中第一項建議的範例。

![購買理由](./media/tutorial-optimize-reserved-instances/aws02.png)

上述範例顯示每年視需要執行工作負載的成本為 $90,456 美元。 不過，如果您事先購買保留，相同工作負載的成本會是 $56,592 美元，每年可為您省下 $33,864 美元。

按一下 [EC2 RI 購買影響] 旁邊的加號，以檢視一整年的損益平衡點，進而了解您的購買投資大約何時會實現。 在下列範例中，大約在購買後八個月，隨選累計成本開始超過 RI 累計成本：

![購買影響](./media/tutorial-optimize-reserved-instances/aws03.png)

您在該時間點開始省錢。

您可以檢閱 [一段時間的執行個體] 以確認購買建議的準確性。 在此範例中，您可看到工作負載在過去 30 天內平均使用六個執行個體。

![一段時間的執行個體](./media/tutorial-optimize-reserved-instances/aws04.png)

## <a name="modify-unused-reservations"></a>修改未使用的保留

在許多雲端資源取用者的運算環境中，未使用的保留很常見。 當您修改保留以符合您目前的需求時，確保完全使用未使用的保留，可讓您節省成本。 例如，您擁有的訂用帳戶可能包含在 Linux 上執行的標準 D3 執行個體。 如果您將不會完全利用此保留，則可變更執行個體類型。 或者，將未使用的資源移至不同的保留或不同的帳戶。

AWS 會銷售特定可用性區域的保留執行個體。 如果您已購買特定可用性區域的保留執行個體，您就無法在區域之間移動保留。 不過，您可以使用 [EC2 目前未使用的保留] 報告，在區域之間輕鬆移動區域性保留執行個體。 或者，您可以將這些保留執行個體修改成具有一個區域性範圍，然後它們就會將相符的執行個體套用於所有的可用性區域。

在入口網站頂端的 [報告] 功能表上，按一下 [最佳化工具] > [效率不足] > [EC2 RI 目前未使用的保留]。

下圖顯示未使用之保留執行個體的報告。

![未使用的保留](./media/tutorial-optimize-reserved-instances/unused-ri01.png)

按一下 [詳細資料] 下方的加號，可檢視特定保留的保留詳細資料。

![未使用的保留詳細資料](./media/tutorial-optimize-reserved-instances/unused-ri02.png)

在上述範例中，各種可用性區域中總共有 77 個未使用的保留。 第一項保留有 51 個未使用的執行個體。 請注意清單下半部，有您可以在 **us-east-1c** 可用性區域中使用 **m3.2xlarge** 執行個體類型進行的可能保留執行個體修改。

針對清單中的第一項保留按一下 [修改]，以開啟 [修改 RI] 頁面，其中顯示保留相關資料。

![修改 RI](./media/tutorial-optimize-reserved-instances/unused-ri03.png)

已列出您可以修改的保留執行個體。 在下圖範例中，您有 51 項未使用的保留可以修改，但是兩項保留之間需要有 54 個。 如果您將未使用的保留修改成全部使用，則會繼續視需要執行四個執行個體。 在此範例中，分割您未使用的保留，其中第一項保留會使用 30 個，而第二項保留會使用 21 個。

按一下第一項保留的加號，並將 [保留數量] 設定為 **30**。 針對第二個項目，將保留數量設定為 **21**，然後按一下 [套用]。

![變更保留數量](./media/tutorial-optimize-reserved-instances/unused-ri04.png)

保留的所有未使用執行個體都已完全利用，51 個執行個體便無法再隨選執行。 在此範例中，您可藉由大幅減少隨選使用並使用已付費的保留，讓您的組織節省成本。

## <a name="next-steps"></a>後續步驟

在本教學課程中，您已成功完成下列工作：

> [!div class="checklist"]
> * 了解 Azure RI 成本
> * 了解 RI 的權益
> * 將 Azure RI 成本最佳化
> * 檢視 RI 成本
> * 評估 Azure AI 成本效益
> * 將 AWS RI 成本最佳化
> * 購買建議的 RI
> * 修改未使用的保留


請前進到下一個教學課程，以了解如何控制資料的存取。

> [!div class="nextstepaction"]
> [控制資料的存取](tutorial-user-access.md)
