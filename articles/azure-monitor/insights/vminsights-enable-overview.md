---
title: 啟用適用於 VM 的 Azure 監視器概觀
description: 瞭解如何部署和設定適用於 VM 的 Azure 監視器。 找出系統需求。
ms.subservice: ''
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 12/22/2020
ms.custom: references_regions
ms.openlocfilehash: 655a146ccde9c75629d0a991a6a3aafa91f40764
ms.sourcegitcommit: c7153bb48ce003a158e83a1174e1ee7e4b1a5461
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/15/2021
ms.locfileid: "98233962"
---
# <a name="enable-azure-monitor-for-vms-overview"></a>啟用適用於 VM 的 Azure 監視器概觀

本文概述可用來啟用適用於 VM 的 Azure 監視器來監視下列專案的健康情況和效能的選項：

- Azure 虛擬機器 
- Azure 虛擬機器擴展集
- 與 Azure Arc 連線的混合式虛擬機器
- 內部部署虛擬機器
- 裝載于其他雲端環境中的虛擬機器。  

若要設定適用於 VM 的 Azure 監視器：

* 從 Azure 入口網站中的功能表直接選取 **見解** ，以啟用單一 azure 虛擬機器、azure 虛擬機器擴展集或 Azure Arc 機。
* 使用 Azure 原則啟用多部 Azure 虛擬機器、Azure 虛擬機器或 Azure Arc 機。 此方法可確保在現有和新的 Vm 和擴展集上，已安裝並正確設定必要的相依性。 系統會報告不符合規範的虛擬機器和擴展集，讓您可以決定是否要加以啟用和修復。
* 使用 PowerShell 來啟用多部 Azure 虛擬機器、Azure Arc 虛擬機器、Azure 虛擬機器擴展集，或在指定的訂用帳戶或資源群組中 Azure Arc 的機器。
* 啟用適用於 VM 的 Azure 監視器以監視公司網路或其他雲端環境中裝載的 Vm 或實體電腦。

## <a name="supported-machines"></a>支援的機器
適用於 VM 的 Azure 監視器支援下列電腦：

- Azure 虛擬機器
- Azure 虛擬機器擴展集
- 與 Azure Arc 連線的混合式虛擬機器


## <a name="supported-azure-arc-machines"></a>支援的 Azure Arc 電腦
適用於 VM 的 Azure 監視器適用于可以使用 Arc 擴充服務之區域中 Azure Arc 已啟用的伺服器。 您必須執行 Arc 代理程式的0.9 版或更新版本。

| 連線的來源 | 支援 | 描述 |
|:--|:--|:--|
| Windows 代理程式 | 是 | 除了 [適用于 windows 的 Log Analytics 代理程式](../platform/log-analytics-agent.md)，windows 代理程式還需要相依性代理程式。 如需詳細資訊，請參閱 [支援的作業系統](../platform/agents-overview.md#supported-operating-systems)。 |
| Linux 代理程式 | 是 | Linux 代理 [程式除了適用于 linux 的 Log Analytics 代理程式](../platform/log-analytics-agent.md)之外，還需要相依性代理程式。 如需詳細資訊，請參閱 [支援的作業系統](#supported-operating-systems)。 |
| System Center Operations Manager 管理群組 | No | |

## <a name="supported-operating-systems"></a>支援的作業系統

適用於 VM 的 Azure 監視器支援支援 Log Analytics 代理程式和 Dependency agent 的任何作業系統。 如需完整清單，請參閱 [Azure 監視器代理 ](../platform/agents-overview.md#supported-operating-systems) 程式的總覽。

> [!IMPORTANT]
> 適用於 VM 的 Azure 監視器來賓健康情況功能在公開預覽版本中有更多的作業系統支援。 如需詳細清單，請參閱 [啟用適用於 VM 的 Azure 監視器來賓健全狀況 (preview) ](vminsights-health-enable.md) 。

請參閱下列有關支援適用於 VM 的 Azure 監視器的相依性代理程式 Linux 支援的考慮清單：

- 只支援預設版本和 SMP Linux 核心版本。
- 所有 Linux 散發套件皆不支援非標準的核心版本，例如實體位址擴充 (PAE) 和 Xen。 例如，不支援版本字串為 *2.6.16.21-0.8-xen* 的系統。
- 不支援自訂核心，包括重新編譯標準核心。
- 若為9.4 版以外的 Debian 散發版本，則不支援對應功能，而且只能從 [Azure 監視器] 功能表使用 [效能] 功能。 它無法直接從 Azure VM 的左窗格中使用。
- 支援 CentOSPlus 核心。
- 必須針對 Spectre 弱點修補 Linux 核心。 如需詳細資料，請洽詢您的 Linux 散發廠商。
## <a name="log-analytics-workspace"></a>Log Analytics 工作區
適用於 VM 的 Azure 監視器需要 Log Analytics 工作區。 如需此工作區的詳細資訊和需求，請參閱 [設定適用於 VM 的 Azure 監視器的 Log Analytics 工作區](vminsights-configure-workspace.md) 。
## <a name="agents"></a>代理程式
適用於 VM 的 Azure 監視器需要在要監視的每部虛擬機器或虛擬機器擴展集上安裝下列兩個代理程式。 若要讓資源上線，請安裝這些代理程式，並將其連線至工作區。  請參閱這些代理程式網路需求的 [網路](../platform/log-analytics-agent.md#network-requirements) 需求。

- [Log Analytics 代理程式](../platform/log-analytics-agent.md)。 從虛擬機器或虛擬機器擴展集收集事件和效能資料，並將其傳遞至 Log Analytics 工作區。 適用于 Azure 資源上的 Log Analytics 代理程式的部署方法會使用適用于 [Windows](../../virtual-machines/extensions/oms-windows.md) 和 [Linux](../../virtual-machines/extensions/oms-linux.md)的 VM 擴充功能。
- Dependency agent。 收集在虛擬機器上執行之進程的探索資料，以及 [適用於 VM 的 Azure 監視器中的對應功能](vminsights-maps.md)所使用的外部進程相依性的相關資訊。 相依性代理程式相依于 Log Analytics 代理程式，以將其資料傳遞至 Azure 監視器。 適用于 Azure 資源上的相依性代理程式的部署方法會使用適用于 [Windows](../../virtual-machines/extensions/agent-dependency-windows.md) 和 [Linux](../../virtual-machines/extensions/agent-dependency-linux.md)的 VM 擴充功能。

> [!NOTE]
> Log Analytics 代理程式是 System Center Operations Manager 所使用的相同代理程式。 適用於 VM 的 Azure 監視器可以監視由 Operations Manager 監視的代理程式（如果這些代理程式是直接連線的代理程式），並在其上安裝相依性代理程式。 透過 [管理群組](../tform/../platform/om-agents.md) 連線連接到 Azure 監視器的代理程式無法由適用於 VM 的 Azure 監視器監視。

以下是部署這些代理程式的多個方法。 

| 方法 | 描述 |
|:---|:---|
| [Azure 入口網站](./vminsights-enable-portal.md) | 在與 Azure Arc 連線的單一虛擬機器、虛擬機器擴展集或混合式虛擬機器上安裝這兩個代理程式。 |
| [Resource Manager 範本](vminsights-enable-resource-manager.md) | 使用支援的任何方法來安裝兩個代理程式，以部署 Resource Manager 範本，包括 CLI 和 PowerShell。 |
| [Azure 原則](./vminsights-enable-policy.md) | 指派 Azure 原則計畫，以在虛擬機器或虛擬機器擴展集建立時自動安裝代理程式。 |
| [手動安裝](./vminsights-enable-hybrid.md) | 將代理程式安裝在裝載于 Azure 外部的電腦（包括在您的資料中心或其他雲端環境中）上的客體作業系統中。 |




## <a name="management-packs"></a>管理組件
針對適用於 VM 的 Azure 監視器設定 Log Analytics 工作區時，會將兩個管理元件轉送至所有連線到該工作區的 Windows 電腦。 管理元件的名稱是 *Microsoft.intelligencepacks.updateassessment microsoft.intelligencepacks.applicationdependencymonitor* 和 *microsoft.intelligencepacks.updateassessment VMInsights* ，並會寫入 *%Programfiles%\Microsoft Monitoring Agent\Agent\Health Service State\Management pack* 中。 

*Microsoft.intelligencepacks.applicationdependencymonitor* 管理元件所使用的資料來源為 **% Program Files%\Microsoft Monitoring Agent\Agent\Health Service State\Resources \<AutoGeneratedID>\Microsoft.EnterpriseManagement.Advisor.ApplicationDependencyMonitorDataSource.dll*。 *VMInsights* 管理元件所使用的資料來源為 *% Program Files%\Microsoft Monitoring Agent\Agent\Health Service State\Resources \<AutoGeneratedID> \ Microsoft.VirtualMachineMonitoringModule.dll*。

## <a name="diagnostic-and-usage-data"></a>診斷和使用量資料

當您使用 Azure 監視器服務時，Microsoft 會自動收集使用量和效能資料。 Microsoft 會使用此資料來改善服務的品質、安全性和完整性。 

為了提供正確且有效率的疑難排解功能，地圖功能包含軟體設定的相關資料。 資料會提供作業系統和版本、IP 位址、DNS 名稱和工作站名稱等資訊。 Microsoft 不會收集姓名、地址或其他連絡資訊。

如需有關資料收集與使用方式的詳細資訊，請參閱 [Microsoft 線上服務隱私權聲明](https://go.microsoft.com/fwlink/?LinkId=512132)。

[!INCLUDE [GDPR-related guidance](../../../includes/gdpr-dsr-and-stp-note.md)]

## <a name="next-steps"></a>後續步驟

若要瞭解如何使用效能監視功能，請參閱 [View 適用於 VM 的 Azure 監視器 performance](vminsights-performance.md)。 若要檢視探索到的應用程式相依性，請參閱[檢視適用於 VM 的 Azure 監視器對應](vminsights-maps.md)。
