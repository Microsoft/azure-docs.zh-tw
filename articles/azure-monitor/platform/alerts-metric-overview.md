---
title: 了解計量警示在 Azure 監視器中的運作方式。
description: 取得計量警示有何用途以及其在 Azure 監視器中如何運作的概觀。
ms.date: 01/13/2021
ms.topic: conceptual
ms.subservice: alerts
ms.openlocfilehash: d8e0621f88455a68ad0ee1b236f6b423c9d54b52
ms.sourcegitcommit: c136985b3733640892fee4d7c557d40665a660af
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/13/2021
ms.locfileid: "98179889"
---
# <a name="understand-how-metric-alerts-work-in-azure-monitor"></a>了解計量警示在 Azure 監視器中的運作方式

Azure 監視器中的計量警示以多維度計量為基礎運作。 這些計量可能是[平台計量](alerts-metric-near-real-time.md#metrics-and-dimensions-supported)、[自訂計量](./metrics-custom-overview.md)、[來自 Azure 監視器並轉換為計量的常用記錄](./alerts-metric-logs.md)，以及 Application Insights 計量。 計量警示會定期評估，檢查一或多個計量時間序列上的條件是否為真，並在評估符合時通知您。 計量警示具狀態，也就是說只會在狀態變更時傳送通知。

## <a name="how-do-metric-alerts-work"></a>計量警示的運作方式為何？

您可以藉由指定要監視的目標資源、計量名稱、條件類型 (靜態或動態) 以及條件 (運算子與閾值/敏感度) 來定義計量警示規則，以及要在警示規則引發時觸發的動作群組。 條件類型會影響決定閾值的方式。 [深入了解動態閾值條件類型和敏感度選項](alerts-dynamic-thresholds.md)。

### <a name="alert-rule-with-static-condition-type"></a>具有靜態條件類型的警示規則

假設您已建立簡單的靜態閾值計量警示規則，如下所示：

- 目標資源 (您要監視的 Azure 資源)：myVM
- 計量：CPU 百分比
- 條件類型：靜態
- 時間彙總 (針對未經處理的計量值執行的統計資料。 [支援的時間](metrics-charts.md#changing-aggregation) 匯總為 Min、Max、Avg、Total、Count) ： Average
- 期間 (查看檢查計量值的時間範圍) ：過去5分鐘內
- 頻率 (計量警示檢查條件是否符合的頻率) ：1分鐘
- 運算子：大於
- 閾值：70

從警示規則建立後開始，監視器會每隔 1 分鐘執行一次，並查看過去 5 分鐘的計量值，以及檢查這些值的平均是否超過 70。 如果條件符合，也就是說過去 5 分鐘的 CPU 百分比平均超過 70，則警示規則會引發啟動通知。 如果您已在與警示規則相關聯的動作群組中設定電子郵件或 Webhook 動作，您會收到兩者的啟動通知。

當您在一個規則中使用多個條件時，規則會將條件「and」在一起。 也就是說，當警示規則中的所有條件都評估為 true 時，會引發警示，並在其中一個條件不再成立時解決。 這種類型的警示規則的範例是監視 Azure 虛擬機器，並在兩個「CPU 百分比高於90%」和「佇列長度超過300個專案」時發出警示。

### <a name="alert-rule-with-dynamic-condition-type"></a>具有動態條件類型的警示規則

假設您已建立簡單的動態閾值計量警示規則，如下所示：

- 目標資源 (您要監視的 Azure 資源)：myVM
- 計量：CPU 百分比
- 條件類型：動態
- 時間彙總 (針對未經處理的計量值執行的統計資料。 [支援的時間](metrics-charts.md#changing-aggregation) 匯總為 Min、Max、Avg、Total、Count) ： Average
- 期間 (查看檢查計量值的時間範圍) ：過去5分鐘內
- 頻率 (計量警示檢查條件是否符合的頻率) ：1分鐘
- 運算子：大於
- 敏感度：中
- 回顧期：4
- 違規次數：4

在警示規則建立後，動態閾值機器學習演算法會取得可用的歷史資料，計算最符合計量序列行為模式的閾值，並且根據新資料持續學習，讓閾值更準確。

從警示規則建立後開始，監視器會每隔 1 分鐘執行一次，並查看過去 20 分鐘 (以 5 分鐘的期間分組) 的計量值，以及檢查這 4 個期間的平均值是否超過預期的閾值。 如果條件符合，也就是說過去 20 分鐘 (四個 5 分鐘的期間) 的 CPU 百分比平均值超過偏離預期的行為四次，則警示規則會引發啟動的通知。 如果您已在與警示規則相關聯的動作群組中設定電子郵件或 Webhook 動作，您會收到兩者的啟動通知。

### <a name="view-and-resolution-of-fired-alerts"></a>檢視並解決觸發的警示

前述警示規則引發範例也可在 Azure 入口網站的 [所有警示] 刀鋒視窗中檢視。

假設在後續檢查中，"myVM" 上的使用量一直高於閾值，除非解決該情況，否則不會再次引發警示規則。

經過一段時間後，"myVM" 上的使用量會恢復正常 (低於閾值) 。 警示規則會再監視該條件兩次，以傳送解決通知。 當連續三個期間的警示條件都不符合時，警示規則會傳送已解決/停用訊息，以減少不穩定情況下的雜訊。

透過 Webhook 或電子郵件傳送已解決通知時，Azure 入口網站中警示執行個體的狀態 (稱為監視器狀態)，也會設定為已解決。

> [!NOTE]
>
> 當警示規則監視多個條件時，如果至少有一個條件不再符合三個連續的期間，就會解決引發的警示。

### <a name="using-dimensions"></a>使用維度

Azure 監視器中的計量警示也支援以一個規則監視多個維度值組合。 讓我們借助範例，來了解為什麼您可能會使用多個維度組合。

假設您有要用於網站的 App Service 方案。 您想要針對執行您網站/應用程式的多個執行個體監視其 CPU 使用量。 您可以使用計量警示規則，如下所示：

- 目標資源：myAppServicePlan
- 計量：CPU 百分比
- 條件類型：靜態
- 維度
  - 執行個體 = InstanceName1、InstanceName2
- 時間彙總：平均
- 期間 = 過去 5 分鐘內
- 頻率：1 分鐘
- 運算子：大於
- 閾值：70

和之前一樣，此規則會監視過去 5 分鐘的平均 CPU 使用量是否超過 70%。 不過，使用相同的規則，您可以監視兩個執行您網站的執行個體。 每個執行個體都是個別監視，而您也會個別得到通知。

假設您的 Web 應用程式預計會面臨大量需求，而您需要新增更多執行個體。 上述規則仍只會監視兩個執行個體。 不過，您可以建立規則，如下所示：

- 目標資源：myAppServicePlan
- 計量：CPU 百分比
- 條件類型：靜態
- 維度
  - 執行個體 = *
- 時間彙總：平均
- 期間 = 過去 5 分鐘內
- 頻率：1 分鐘
- 運算子：大於
- 閾值：70

此規則會自動監視執行個體的所有值，也就是說 您可以在執行個體顯示時監視，而不需要再次修改計量警示規則。

監視多個維度時，動態閾值警示規則可同時為數百個計量序列建立合適的閾值。 動態閾值可減少需要管理的警示規則，且在警示規則的管理和建立方面都可省下大量時間。

假設您的 Web 應用程式有多個執行個體，而您不知道最適合的閾值為何。 上述規則一律會使用 70% 的閾值。 不過，您可以建立規則，如下所示：

- 目標資源：myAppServicePlan
- 計量：CPU 百分比
- 條件類型：動態
- 維度
  - 執行個體 = *
- 時間彙總：平均
- 期間 = 過去 5 分鐘內
- 頻率：1 分鐘
- 運算子：大於
- 敏感度：中
- 回顧期：1
- 違規次數：1

此規則會監視過去 5 分鐘的平均 CPU 使用量是否超過每個執行個體的預期行為。 同樣地，您可以在執行個體顯示時監視，而不需要再次修改計量警示規則。 每個執行個體都會取得符合計量序列行為模式的閾值，並且根據新資料持續變更，使閾值更為精確。 同樣地，每個執行個體都個別受到監視，而您也會個別得到通知。

增加回溯查看期間和違規次數，也可以讓篩選警示僅對您的重大偏差定義發出警示。 [深入了解動態閾值進階選項](alerts-dynamic-thresholds.md#what-do-the-advanced-settings-in-dynamic-thresholds-mean)。

> [!NOTE]
>
> 我們建議您選擇大於 *評估頻率* 的 *匯總資料細微性 (期間)* ，以降低在下列情況下遺漏新增時間序列第一次評估的可能性：
> - 監視多個維度的度量警示規則-新增維度值組合時
> - 監視多個資源的計量警示規則-將新資源新增至範圍時
> - 計量警示規則，可監視未持續發出 (稀疏計量) 的計量–當計量在一段時間超過24小時未發出時發出時



## <a name="monitoring-at-scale-using-metric-alerts-in-azure-monitor"></a>在 Azure 監視器中使用計量警示大規模進行監視

到目前為止，您已經了解如何使用單一計量警示來監視與單一 Azure 資源相關的一或多個計量時間序列。 很多時候，您可能想將相同的警示規則套用至許多資源。 針對存在於相同 Azure 區域中的資源，Azure 監視器也支援監視多個具有一個計量警示規則的相同類型 () 的資源。 

這項功能目前支援平臺計量 (非自訂計量) 適用于下列 Azure 雲端中的下列服務：

| 服務 | 公用 Azure | 政府機關 | 中國 |
|:--------|:--------|:--------|:--------|
| 虛擬機器<sup>1</sup>  | **是** | **是** | 否 |
| SQL server 資料庫 | **是** | **是** | **是** |
| SQL server 彈性集區 | **是** | **是** | **是** |
| NetApp files 容量集區 | **是** | **是** | **是** |
| NetApp files 磁片區 | **是** | **是** | **是** |
| 金鑰保存庫 | **是** | **是** | **是** |
| Azure Cache for Redis | **是** | **是** | **是** |
| Data box edge 裝置 | **是** | **是** | **是** |

<sup>1</sup> 不支援虛擬機器網路計量 (網路總計、網路輸出、輸入流量、輸出流量、輸入流量最大建立速率、輸出流量最大建立速率) 。

您可以透過下列三種方式之一，指定單一計量警示規則監視的範圍。 例如，有了虛擬機器，您可以將範圍指定為：  

- 在訂用帳戶內) 一個 Azure 區域中 (的虛擬機器清單
- 作為訂用帳戶中一或多個資源群組的所有虛擬機器 (位於一個 Azure 區域)
- 訂用帳戶中的一個 Azure 區域) 的所有虛擬機器 (

> [!NOTE]
>
> 多重資源計量警示規則的範圍必須包含至少一個所選資源類型的資源。

建立監視多個資源的計量警示規則，類似於[建立監視單一資源的任何其他計量警示](alerts-metric.md)。 唯一的區別是您會選取要監視的所有資源。 您也可以透過 [Azure Resource Manager 範本](./alerts-metric-create-templates.md#template-for-a-metric-alert-that-monitors-multiple-resources)建立這些規則。 您會收到每個受監視資源的個別通知。

> [!NOTE]
>
> 在監視多個資源的計量警示規則中，只允許一個準則。

## <a name="typical-latency"></a>一般延遲

針對計量警示，如果您將警示規則頻率設定為 1 分鐘，通常可在 5 分鐘內得到通知。在通知系統負載過重時，則可能會延遲較久。

## <a name="supported-resource-types-for-metric-alerts"></a>計量警示支援的資源類型

您可以在 [本文](./alerts-metric-near-real-time.md#metrics-and-dimensions-supported)中找到所支援資源類型的完整清單。


## <a name="next-steps"></a>下一步

- [瞭解如何在 Azure 中建立、查看和管理計量警示](alerts-metric.md)
- [瞭解如何在 Azure 監視器計量瀏覽器中建立警示](./metrics-charts.md#create-alert-rules)
- [了解如何使用 Azure Resource Manager 範本部署計量警示](./alerts-metric-create-templates.md)
- [深入瞭解動作群組](action-groups.md)
- [深入了解動態閾值條件類型](alerts-dynamic-thresholds.md)
- [深入瞭解如何針對計量警示中的問題進行疑難排解](alerts-troubleshoot-metric.md)

