---
title: 使用 Azure Logic Apps 建立定期執行的工作和工作流程 | Microsoft Docs
description: 自動執行工作和工作流程，其透過 Azure Logic Apps 中的週期連接器依排程執行
services: logic-apps
ms.service: logic-apps
ms.suite: integration
author: ecfan
ms.author: estfan
ms.reviewer: klam, LADocs
ms.assetid: 51dd4f22-7dc5-41af-a0a9-e7148378cd50
tags: connectors
ms.topic: article
ms.date: 09/25/2017
ms.openlocfilehash: 905157ab530ae042318de520f9d6fe24cb9d59ce
ms.sourcegitcommit: 2ad510772e28f5eddd15ba265746c368356244ae
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/28/2018
ms.locfileid: "43127049"
---
# <a name="create-and-run-recurring-tasks-and-workflows-with-azure-logic-apps"></a>使用 Azure Logic Apps 建立並執行週期性工作和工作流程

若要排程定期執行的工作、動作、工作負載或程序，您可以先使用**排程 - 重複**[觸發程序](../logic-apps/logic-apps-overview.md#logic-app-concepts)，建立邏輯應用程式工作流程。 使用此觸發程序，您可以設定開始重複的日期和時間，以及執行工作的重複排程，例如下列範例等等：

* 取得內部資料：每天[執行 SQL 預存程序](../connectors/connectors-create-api-sqlazure.md)。
* 取得外部資料：每 15 分鐘從美國國家海洋暨大氣總署 (NOAA) 提取氣象報告。
* 報告資料：以電子郵件寄送過去一週大於指定金額的所有訂單摘要。
* 處理資料：在每個工作天的離峰時間壓縮今天已上傳的影像。
* 清理資料：刪除三個月前的所有推文。
* 封存資料：每個月發送發票到備份服務。

此觸發程序支援許多模式，例如：

* 立即執行，並且每 *n* 秒、分鐘、小時、天、週或月重複一次。
* 在特定的時間開始，然後每 *n* 秒、分鐘、小時、天、週或月執行並重複。
* 每天執行並重複一次或多次，例如上午 8:00 和下午 5:00。
* 每週執行並重複，但僅在特定的星期幾，例如星期六和星期日。
* 每週執行並重複，但僅在特定的星期幾和時間，例如星期一到星期五的上午 8:00 和下午 5:00。

每次引發重複觸發程序時，Logic Apps 會建立並執行新的邏輯應用程式工作流程執行個體。

## <a name="prerequisites"></a>必要條件

* Azure 訂用帳戶。 如果您沒有訂用帳戶，您可以[開始使用免費 Azure 帳戶](https://azure.microsoft.com/free/)。 否則，您可以[註冊隨用隨付訂用帳戶](https://azure.microsoft.com/pricing/purchase-options/)。

* [如何建立邏輯應用程式](../logic-apps/quickstart-create-first-logic-app-workflow.md)的基本知識 

## <a name="add-a-recurrence-trigger-to-your-logic-app"></a>將重複觸發程序新增至邏輯應用程式

1. 登入 [Azure 入口網站](https://portal.azure.com)。 建立空白的邏輯應用程式，或了解[如何建立空白邏輯應用程式](../logic-apps/quickstart-create-first-logic-app-workflow.md)。

2. Logic Apps 設計工具出現之後，在搜尋方塊中輸入「重複」作為篩選條件。 選取 [排程 - 重複] 觸發程序。 

   ![排程 - 重複觸發程序](./media/connectors-native-recurrence/add-recurrence-trigger.png)

   此觸發程序現在在您的邏輯應用程式中是第一個步驟。

3. 設定重複的間隔和頻率。 在此範例中，將這些屬性設定為每週執行工作流程。 

   ![設定間隔和頻率](./media/connectors-native-recurrence/recurrence-trigger-details.png)

4. 如需更多的排程選項，請選擇 [顯示進階選項]。 

   ![更多選項](./media/connectors-native-recurrence/recurrence-trigger-more-options.png)

5. 現在您可以設定這些選項： 

   * 設定開始日期和時間來引發觸發程序。 
   如果您指定開始日期和時間，也可以套用時區。 

   * 如果您選取 [天] 或 [週] 的頻率，可以選取重複的特定時間。 

   * 如果您選取 [週]，也可以選取一週的星期幾。
   
   ![進階排程選項](./media/connectors-native-recurrence/recurrence-trigger-more-options-details.png)

   例如，假設今天是 2017 年 9 月 4 日星期一。 
   下列重複觸發程序不會「早於」開始日期和時間，也就是太平洋標準時間 2017 年 9 月 18 日星期一上午 8:00 引發。 
   不過，重複排程已設定為只在星期一的上午 10:30、下午 12:30 和下午 2:30。 因此觸發程序第一次引發並建立邏輯應用程式工作流程執行個體的時間是在上午 10:30。 
   若要深入了解開始時間如何運作，請參閱這些[開始時間範例](#start-time)。
   未來則會在同一天的下午 12:30 和下午 2:30 執行。 
   每次重複都會建立自己的工作流程執行個體。 之後，整個排程會在下個星期一全部重複一次。 
   [*還有其他哪些範例重複？*](#example-recurrences)

   ![進階排程範例](./media/connectors-native-recurrence/recurrence-trigger-more-options-advanced-schedule.png)

   > [!NOTE]
   > 只有當您選取 [天] 或 [週] 作為頻率時，觸發程序才會顯示指定週期的預覽。
   
6. 現在使用動作或流程控制陳述式，建立您其餘的工作流程。 如需您可以加入的更多動作，請參閱[連接器](../connectors/apis-list.md)。 

## <a name="trigger-details"></a>觸發程序詳細資料

您可以設定重複觸發程序的下列屬性。

| 名稱 | 必要 | 屬性名稱 | 類型 | 說明 | 
|----- | -------- | ------------- | ---- | ----------- | 
| **頻率** | 是 | frequency | 字串 | 重複的時間單位：**秒**、**分鐘**、**小時**、**天**、**週**或**月** | 
| **間隔** | 是 | interval | 整數  | 描述工作流程根據 frequency 多久執行一次的正整數。 <p>預設間隔是 1。 以下是最小和最大間隔： <p>- 月：1-16 個月 </br>- 天：1-500 天 </br>- 小時：1-12,000 個小時 </br>- 分鐘：1-72,000 分鐘 </br>- 秒：1-9,999,999 秒<p>例如，如果 interval 是 6，而 frequency 是「月」，則週期為每隔 6 個月。 | 
| **時區** | 否 | timeZone | 字串 | 只有當您有指定開始時間時才適用，因為此觸發程序並不接受 [UTC 時差](https://en.wikipedia.org/wiki/UTC_offset)。 選取您要套用的時區。 | 
| **開始時間** | 否 | startTime | 字串 | 提供下列格式的開始時間： <p>YYYY-MM-DDThh:mm:ss (如果您選取時區) <p>-或- <p>YYYY-MM-DDThh:mm:ssZ (如果您未選取時區) <p>因此，舉例來說，如果您想要的是 2017 年 9 月 18 日下午 2:00，則請指定 "2017-09-18T14:00:00"，然後選取時區，例「美國太平洋時間」。 或是指定 "2017-09-18T14:00:00Z"，但不指定時區。 <p>**注意：** 這個開始時間必須依照 [UTC 日期時間格式](https://en.wikipedia.org/wiki/Coordinated_Universal_Time)中的 [ISO 8601 日期時間規格](https://en.wikipedia.org/wiki/ISO_8601#Combined_date_and_time_representations)，但不含 [UTC 時差](https://en.wikipedia.org/wiki/UTC_offset)。 如果您不選取時區，就必須在結尾加上字母 "Z"，其中不含任何空格。 這個 "Z" 係指對等的[航海時間](https://en.wikipedia.org/wiki/Nautical_time)。 <p>就簡單排程來說，開始時間係指第一次發生的時間，而就複雜排程來說，觸發程序會在開始時間一到就立即引發。 [*我可以使用開始日期和時間的方式有哪些？*](#start-time) | 
| **在這幾天內** | 否 | weekDays | 字串或字串陣列 | 如果您選取 [週]，可以選取想要在哪一天或哪幾天執行工作流程：**星期一**、**星期二**、**星期三**、**星期四**、**星期五**、**星期六**和**星期日** | 
| **在這幾小時內** | 否 | hours | 整數或整數陣列 | 如果您選取 [天] 或 [週]，可以選取從 0 到 23 的一或多個整數，來表示想要在一天中的哪幾個整點執行工作流程。 <p>例如，如果您指定 "10"、"12" 及 "14"，就會得出上午 10 點、下午 12 點及下午 2 點作為整點標記。 | 
| **在這幾分鐘內** | 否 | minutes | 整數或整數陣列 | 如果您選取 [天] 或 [週]，可以選取從 0 到 59 的一或多個整數，來表示想要在小時的哪幾個分鐘執行工作流程。 <p>例如，您可以指定 "30" 作為分鐘標記，然後使用上個範例代表一天中的整點，這樣就會得出上午 10:30、下午 12:30 及下午 2:30。 | 
||||| 

## <a name="json-example"></a>JSON 範例

以下是範例[重複觸發程序定義](../logic-apps/logic-apps-workflow-actions-triggers.md#recurrence-trigger)：

``` json
{
    "triggers": {
        "Recurrence": {
            "type": "Recurrence",
            "recurrence": {
                "frequency": "Week",
                "interval": 1,
                "schedule": {
                    "hours": [
                        10,
                        12,
                        14
                    ],
                    "minutes": [
                        30
                    ],
                    "weekDays": [
                        "Monday"
                    ]
                },
               "startTime": "2017-09-07T14:00:00",
               "timeZone": "Pacific Standard Time"
            }
        }
    }
}
```

## <a name="faq"></a>常見問題集

<a name="example-recurrences"></a>

**問：** 還有其他哪些範例重複排程？ </br>
**答：** 以下還有其他範例：

| 週期性 | 間隔 | 頻率 | 開始時間 | 在這幾天內 | 在這幾小時內 | 在這幾分鐘內 | 附註 |
| ---------- | -------- | --------- | ---------- | ------------- | -------------- | ---------------- | ---- |
| 每隔 15 分鐘執行一次 (沒有開始日期和時間) | 15 | 分鐘 | {無} | {無法使用} | {無} | {無} | 此排程會立即開始，然後根據上次執行的時間計算未來的週期。 | 
| 每隔 15 分鐘執行一次 (有開始日期和時間) | 15 | 分鐘 | *startDate*T*startTime*Z | {無法使用} | {無} | {無} | 此排程不會「早於」指定的開始日期和時間開始，並且會根據上次執行的時間計算未來的週期。 | 
| 整點每小時執行一次 (有開始日期和時間) | 1 | 小時 | *startDate*Thh:00:00Z | {無法使用} | {無} | {無} | 此排程不會「早於」指定的開始日期和時間開始。 未來會在每小時的 "00" 分鐘標記處時重複執行。 <p>如果頻率是 [週] 或 [月]，則此排程只會分別在每週的一天或每個月的一天執行。 | 
| 每天的每個小時執行一次 (沒有開始日期和時間) | 1 | 小時 | {無} | {無法使用} | {無} | {無} | 此排程會立即開始，然後根據上次執行的時間計算未來的週期。 <p>如果頻率是 [週] 或 [月]，則此排程只會分別在每週的一天或每個月的一天執行。 | 
| 每天的每個小時執行一次 (有開始日期和時間) | 1 | 小時 | *startDate*T*startTime*Z | {無法使用} | {無} | {無} | 此排程不會「早於」指定的開始日期和時間開始，並且會根據上次執行的時間計算未來的週期。 <p>如果頻率是 [週] 或 [月]，則此排程只會分別在每週的一天或每個月的一天執行。 | 
| 每小時的整點過後，每隔 15 分鐘執行一次 (有開始日期和時間) | 1 | 小時 | *startDate*T00:15:00Z | {無法使用} | {無} | {無} | 此排程不會「早於」指定的開始日期和時間開始，在上午 00:15、上午 1:15、上午 2:15 (依此類推) 執行。 | 
| 每小時的整點過後，每隔 15 分鐘執行一次 (沒有開始日期和時間) | 1 | 天 | {無} | {無法使用} | 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23 | 15 | 此排程在上午 00:15、上午 1:15、上午 2:15 (依此類推) 執行。 而且，此排程相當於「小時」的頻率，且開始時間為 "15" 分鐘。 | 
| 在 15 分鐘標記處每隔 15 分鐘執行一次 (沒有開始日期和時間) | 1 | 天 | {無} | {無法使用} | 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23 | 0, 15, 30, 45 | 此排程會在到達下一個指定的 15 分鐘標記處開始。 | 
| 每天上午 8:00 執行 (沒有開始日期和時間) | 1 | 天 | {無} | {無法使用} | 8 | {無} | 此排程根據指定的排程，在每天的上午 8:00 執行。 | 
| 每天上午 8:00 執行 (有開始日期和時間) | 1 | 天 | *startDate*T08:00:00Z | {無法使用} | {無} | {無} | 此排程根據指定的開始時間，在每天的上午 8:00 執行。 | 
| 每天上午 8:30 執行 (沒有開始日期和時間) | 1 | 天 | {無} | {無法使用} | 8 | 30 | 此排程根據指定的排程，在每天的上午 8:30 執行。 | 
| 每天上午 8:30 執行 (有開始日期和時間) | 1 | 天 | *startDate*T08:30:00Z | {無法使用} | {無} | {無} | 此排程在指定開始日期的上午 8:30 開始。 | 
| 每天上午 8:30 和下午 4:30 執行 | 1 | 天 | {無} | {無法使用} | 8, 16 | 30 | | 
| 每天上午 8:30、上午 8:45、下午 4:30 及下午 4:45 執行 | 1 | 天 | {無} | {無法使用} | 8, 16 | 30, 45 | | 
| 每個星期六的下午 5 點執行 (沒有開始日期和時間) | 1 | 週 | {無} | "Saturday" | 17 | 00 | 此排程在每個星期六的下午 5:00 執行。 | 
| 每個星期六的下午 5 點執行 (有開始日期和時間) | 1 | 週 | *startDate*T17:00:00Z | "Saturday" | {無} | {無} | 此排程不會「早於」指定的開始日期和時間開始，在此案例中是 2017 年 9 月 9 日下午 5:00。 未來會在每個星期六的下午 5:00 重複執行。 | 
| 每個星期二、星期四的下午 5 點執行 | 1 | 週 | {無} | "Tuesday", "Thursday" | 17 | {無} | 此排程在每個星期二和星期四的下午 5:00 執行。 | 
| 在工作時間內的每小時執行一次 | 1 | 週 | {無} | 選取除了星期六和星期日以外的所有日子。 | 選取您想要的整點。 | 選取您想要的任何分鐘。 | 例如，如果您的工作時間是上午 8:00 到下午 5:00，則請選取 "8, 9, 10, 11, 12, 13, 14, 15, 16, 17" 作為整點。 <p>如果您的工作時間是上午 8:30 到下午 5:30，則請選取之前的整點，加上 "30" 作為分鐘。 | 
| 週末每天執行一次 | 1 | 週 | {無} | "Saturday", "Sunday" | 選取您想要的整點。 | 視需要選取任何分鐘。 | 此排程會在每個星期六和星期日的指定排程執行。 | 
| 只在隔週星期一的每隔 15 分鐘執行一次 | 2 | 週 | {無} | "Monday" | 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23 | 0, 15, 30, 45 | 此排程會在每個其他星期一的每隔 15 分鐘標記處執行一次。 | 
| 每個月其中一天的每小時執行一次 | 1 | 月 | {請參閱注意} | {無法使用} | 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23 | {請參閱注意} | 如果您未指定開始日期和時間，則此排程會使用建立日期和時間。 若要控制重複排程的分鐘，請指定分鐘、開始時間，或使用建立時間。 例如，如果開始時間或建立時間是上午 8:25，則此排程會在上午 8:25、上午 9:25、上午 10:25 (依此類推) 執行。 | 
||||||||| 

<a name="start-time"></a>

**問：** 我可以使用開始日期和時間的方式有哪些？ </br>
**答：** 以下是一些顯示您如何控制有開始日期和時間的週期，以及 Logic Apps 引擎如何執行這些週期的模式：

| 開始時間 | 週期性無排程 | 週期性有排程 | 
| ---------- | --------------------------- | ------------------------ | 
| {無} | 立即執行第一個工作負載。 <p>根據上次執行的時間執行未來的工作負載。 | 立即執行第一個工作負載。 <p>根據指定的排程執行未來的工作負載。 | 
| 過去的開始時間 | 根據指定的開始時間計算執行時間，並捨棄過去的執行時間。 在未來的下一個執行時間執行第一個工作負載。 <p>根據上次執行時間的計算，執行未來的工作負載。 <p>如需詳細說明，請參閱本表格後的範例。 | 根據從開始時間計算的排程，在開始時間「之後」才執行第一個工作負載。 <p>根據指定的排程執行未來的工作負載。 <p>**注意：** 如果您指定有排程的週期，但未指定排程的小時或分鐘，則未來的執行時間會分別使用第一次執行時間之後的小時或分鐘來計算。 | 
| 目前或未來的開始時間 | 在指定的開始時間執行第一個工作負載。 <p>根據上次執行時間的計算，執行未來的工作負載。 | 根據從開始時間計算的排程，在開始時間「之後」才執行第一個工作負載。 <p>根據指定的排程執行未來的工作負載。 <p>**注意：** 如果您指定有排程的週期，但未指定排程的小時或分鐘，則未來的執行時間會分別使用第一次執行時間之後的小時或分鐘來計算。 | 
||||

**開始時間在過去，有週期但沒有排程的範例** 

| 開始時間 | 目前時間 | 週期性 | 排程 |
| ---------- | ------------ | ---------- | -------- | 
| 2017-09-**07**T14:00:00Z | 2017-09-**08**T13:00:00Z | 每 2 天 | {無} | 
||||| 

在此案例中，Logic Apps 引擎會根據開始時間計算執行時間，捨棄過去的執行時間，並使用下一個未來的開始時間來執行第一次。 第一次執行之後，未來的執行是根據從開始時間計算的排程。 此週期看起來如下：

| 開始時間 | 第一次執行時間 | 未來的執行時間 | 
| ---------- | ------------ | ---------- | 
| 2017-09-**07**下午 2:00 | 2017-09-**09**下午 2:00 | 2017-09-**11**下午 2:00 </br>2017-09-**13**下午 2:00 </br>2017-09-**15**下午 2:00 </br>依此類推。
||||| 

所以對於此案例而言，無論您指定的開始時間 (例如，2017-09-**05**下午 2:00 或 2017-09-**01**下午 2:00) 已經過了多久，第一次執行的時間都相同。

## <a name="next-steps"></a>後續步驟

* [工作流程動作與觸發程序](../logic-apps/logic-apps-workflow-actions-triggers.md#recurrence-trigger)
* [連接器](../connectors/apis-list.md)
