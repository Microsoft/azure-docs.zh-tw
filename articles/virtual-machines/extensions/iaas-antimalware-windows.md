---
title: 適用於 Azure 上 Windows VM 的 Microsoft Antimalware 擴充功能 | Microsoft Docs
description: 在 Windows 虛擬機器上使用擴充功能部署 Azure Antimalware 擴充功能。
services: virtual-machines-windows
documentationcenter: ''
author: TomShinder
manager: jeconnoc
editor: ''
ms.assetid: ''
ms.service: virtual-machines-windows
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: infrastructure-services
ms.date: 04/12/2018
ms.author: tomsh
ms.openlocfilehash: 838e8f2128e446a0c1bfb2ea03fd4f9203e6100e
ms.sourcegitcommit: d98d99567d0383bb8d7cbe2d767ec15ebf2daeb2
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 05/10/2018
ms.locfileid: "33944970"
---
# <a name="microsoft-antimalware-extension-for-windows"></a>適用於 Windows 的 Microsoft Antimalware 擴充功能

## <a name="overview"></a>概觀

現今雲端環境的威脅型態非常多變，因此企業 IT 雲端訂閱者為了遵循法規與達到安全性需求，在維護有效保護機制方面承受許多壓力。 「適用於 Azure 的 Microsoft Antimalware」是一項免費的即時保護功能，能夠協助識別並移除病毒、間諜軟體及其他惡意軟體，且具有可設定的警示，可在已知的惡意或垃圾軟體嘗試在您的 Azure 系統上安裝或執行時發出警示。 此解決方案建置在與 Microsoft Security Essentials (MSE)、Microsoft Forefront Endpoint Protection、Microsoft System Center Endpoint Protection、Windows Intune 及適用於 Windows 8.0 和更新版本的 Windows Defender 相同的反惡意程式碼平台。
適用於 Azure 的 Microsoft Antimalware 是一個針對應用程式和租用戶環境所提供的單一代理程式解決方案，其設計可於無人為介入的情況下在背景中執行。 您可依據應用程式工作負載需求，選擇預設的基本安全性或進階的自訂組態 (包括反惡意程式碼監視) 來部署保護。

## <a name="prerequisites"></a>先決條件

### <a name="operating-system"></a>作業系統

適用於 Azure 的 Microsoft Antimalware 解決方案包含 Microsoft Antimalware 用戶端和服務、Antimalware 傳統部署模型、Antimalware PowerShell Cmdlet 及 Azure 診斷延伸模組。 Windows Server 2008 R2、Windows Server 2012 和 Windows Server 2012 R2 作業系統系列可支援 Microsoft Antimalware 解決方案。 在 Windows Server 2008 作業系統上則不支援此解決方案，且在 Linux 中也不支援。 

Windows Defender 是在 Windows Server 2016 中啟用的內建反惡意程式碼軟體。 某些 Windows Server 2016 SKU 預設也會啟用 Windows Defender 介面。
您仍然可以將 Azure VM Antimalware 擴充功能新增至包含 Windows Defender 的 Windows Server 2016 Azure VM 中，但是在這種情況下，擴充功能將會套用 Windows Defender 所使用的所有選擇性組態原則，而不會部署其他任何反惡意程式碼軟體服務。 您可以在[這裡](https://blogs.msdn.microsoft.com/azuresecurity/2017/03/07/update-to-azure-antimalware-extension-for-cloud-services/)閱讀該項更新的詳細資訊。

### <a name="internet-connectivity"></a>網際網路連線

適用於 Windows 的 Microsoft Antimalware 會要求目標虛擬機器連線至網際網路，以定期接收引擎和特徵碼更新。 

## <a name="template-deployment"></a>範本部署
也可以使用 Azure Resource Manager 範本部署 Azure VM 擴充功能。 部署一或多部需要部署後設定的虛擬機器時 (例如在 Azure Antimalware 上架)，很適合使用範本。

虛擬機器擴充功能的 JSON 設定可以巢狀方式置於虛擬機器資源內部，或放在 Resource Manager JSON 範本的根目錄或最上層。 JSON 設定的放置會影響資源名稱和類型的值。 如需詳細資訊，請參閱[設定子資源的名稱和類型](../../azure-resource-manager/resource-manager-templates-resources.md)。 

下列範例假設 VM 擴充功能以巢狀方式置於虛擬機器資源內部。 在巢狀處理擴充資源時，JSON 會放在虛擬機器的 `"resources": []` 物件中。

```json
{
      "type": "Microsoft.Compute/virtualMachines/extensions",
      "name": "[concat(parameters('vmName'),'/', parameters('vmExtensionName'))]",
      "apiVersion": "2017-03-30",
      "location": "[resourceGroup().location]",
      "dependsOn": [
        "[concat('Microsoft.Compute/virtualMachines/', parameters('vmName'))]"
      ],

      "properties": {
        "publisher": "Microsoft.Azure.Security",
        "type": "IaaSAntimalware",
        "typeHandlerVersion": "1.3",
        "settings": {
          "AntimalwareEnabled": "true",
          "Exclusions": {
            "Extensions": ".log;.ldf",
            "Paths": "D:\\IISlogs;D:\\DatabaseLogs",
            "Processes": "mssence.svc"
          },

          "RealtimeProtectionEnabled": "true",
          "ScheduledScanSettings": {
            "isEnabled": "true",
            "scanType": "Quick",
            "day": "7",
            "time": "120"
          }
        },
        "protectedSettings": null
      }
}
```

## <a name="powershell-deployment"></a>PowerShell 部署
根據您部署的類型而定，請使用對應的命令，將 Azure Antimalware 虛擬機器擴充功能部署到現有的虛擬機器中。

  * 傳統 IaaS 虛擬機器 - http://msdn.microsoft.com/library/azure/dn771718.aspx
  * 以 Azure Resource Manager 為基礎的虛擬機器 - https://blogs.msdn.microsoft.com/azuresecurity/2016/02/24/update-on-microsoft-antimalware-and-azure-resource-manager-arm-vms/
  * Azure Service Fabric 叢集 - https://blogs.msdn.microsoft.com/azuresecurity/2016/10/07/add-microsoft-antimalware-to-azure-service-fabric-clusters/
  * 傳統雲端服務 - http://msdn.microsoft.com/library/azure/dn771718.aspx

## <a name="troubleshoot-and-support"></a>疑難排解與支援

### <a name="troubleshoot"></a>疑難排解

Microsoft Antimalware 擴充功能記錄檔可在 - %Systemdrive%\WindowsAzure\Logs\Plugins\Microsoft.Azure.Security.IaaSAntimalware(Or PaaSAntimalware)\1.5.5.x(version#)\CommandExecution.log 取得

### <a name="error-codes-and-their-meanings"></a>錯誤碼及其意義

| 錯誤碼 | 意義 | 可能的動作 |
| :---: | --- | --- |
| -2147156224 | MSI 忙著處理不同的安裝 | 請稍後嘗試執行安裝 |
| -2147156221 | MSE 安裝程式已在執行中 | 一次僅執行一個執行個體 |
| -2147156208 | 磁碟空間不足 < 200 MB | 刪除未使用的檔案，然後重試安裝 |
| -2147156187 | 最後一個安裝、升級、更新或解除安裝要求重新開機 | 重新開機，然後重試安裝 |
| -2147156121 | 安裝程式嘗試移除競爭對手產品。 但競爭對手產品解除安裝失敗 | 嘗試手動移除競爭對手產品、重新開機，然後重試安裝  |
| -2147156116 | 原則檔驗證失敗 | 請確定您將有效的原則 XML 檔案傳遞至安裝程式  |
| -2147156095 | 安裝程式無法啟動 Antimalware 服務 | 確認已正確簽署所有二進位檔，且已安裝正確的授權檔案 |
| -2147023293 | 安裝期間發生嚴重錯誤。 多數情況下會發生。 Epp.msi 無法登錄\啟動\停止 AM 服務或迷你篩選驅動程式 | 此處需要 EPP.msi 的 MSI 記錄檔，以供之後調查之用 |
| -2147023277 | 無法開啟安裝套件 | 請確認套件是否存在而且可以存取，或連絡應用程式廠商，確認這是有效的 Windows Installer 套件 |
| -2147156109 | Defender 是必要的必要條件 |  |
| -2147205073 | 不支援 websso 簽發者 | |
| -2147024893 | 系統找不到指定的路徑 |  |
| -2146885619 | 未加密的訊息或加密訊息的格式不正確 |  |
| -1073741819 | 0x%p 的指示參照 0x%p 的記憶體。 記憶體不得為 %s |  |
| 1 | 函式不正確 |  |


### <a name="support"></a>支援

如果您在本文中有任何需要協助的地方，您可以連絡 [MSDN Azure 和 Stack Overflow 論壇](https://azure.microsoft.com/support/forums/)上的 Azure 專家。 或者，您可以提出 Azure 支援事件。 請移至 [Azure 支援網站](https://azure.microsoft.com/support/options/)，然後選取 [取得支援]。 如需使用 Azure 支援的資訊，請參閱 [Microsoft Azure 支援常見問題集](https://azure.microsoft.com/support/faq/)。