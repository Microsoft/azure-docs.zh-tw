---
title: 連接架構-適用於 MariaDB 的 Azure 資料庫
description: 描述適用於 MariaDB 的 Azure 資料庫伺服器的連線架構。
author: mksuni
ms.author: sumuth
ms.service: jroth
ms.topic: conceptual
ms.date: 6/8/2020
ms.openlocfilehash: 57e14fa4a026dafb085ea636611ab26b6bad7c01
ms.sourcegitcommit: 52e3d220565c4059176742fcacc17e857c9cdd02
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/21/2021
ms.locfileid: "98661699"
---
# <a name="connectivity-architecture-in-azure-database-for-mariadb"></a>適用於 MariaDB 的 Azure 資料庫中的連線架構
本文說明適用於 MariaDB 的 Azure 資料庫連線架構，以及如何將流量導向至 Azure 內部和外部用戶端的適用於 MariaDB 的 Azure 資料庫實例。

## <a name="connectivity-architecture"></a>連線架構

您適用於 MariaDB 的 Azure 資料庫的連線是透過負責將連入連線路由至叢集中伺服器實體位置的閘道所建立。 下圖說明流量的流程。

![連接架構的總覽](./media/concepts-connectivity-architecture/connectivity-architecture-overview-proxy.png)


當用戶端連接到資料庫時，伺服器的連接字串會解析為閘道 IP 位址。 閘道會接聽埠3306上的 IP 位址。 在資料庫叢集中，流量會轉送至適當的適用於 MariaDB 的 Azure 資料庫。 因此，若要連線到您的伺服器（例如從公司網路），則必須開啟用戶端防火牆， **以允許連出流量抵達我們的閘道**。 您可以在下方找到每個區域的閘道所使用的 IP 位址完整清單。

## <a name="azure-database-for-mariadb-gateway-ip-addresses"></a>適用於 MariaDB 的 Azure 資料庫閘道 IP 位址

閘道服務裝載于位於 IP 位址後方的無狀態計算節點群組上，當您的用戶端嘗試連線到適用於 MariaDB 的 Azure 資料庫伺服器時，會先達到此目標。 

在進行中的服務維護過程中，我們會定期重新整理裝載閘道的計算硬體，以確保我們提供最安全且高效能的體驗。 重新整理閘道硬體時，會先建立新的計算節點信號。 這項新的通道會為所有新建立的適用於 MariaDB 的 Azure 資料庫伺服器提供流量，並且在相同區域中有來自較舊閘道環形的不同 IP 位址，以區別流量。 一旦新的環形可以正常運作，則提供現有伺服器的舊版閘道硬體會規劃解除委任。 解除閘道硬體之前，執行其伺服器並聯機到較舊閘道的客戶，會在解除委任之前的三個月內收到電子郵件和 Azure 入口網站的通知。 解除委任閘道可能會影響到您伺服器的連線能力。 

* 您會在應用程式的連接字串中，將閘道 IP 位址硬編碼。 **不建議您這樣做**。 您應該在您的 <servername> 應用程式的連接字串中，以 mariadb.database.azure.com 的格式使用伺服器的完整功能變數名稱 (FQDN) 。 
* 您不會在用戶端防火牆中更新較新的閘道 IP 位址，以允許連出流量抵達新的閘道通道。

下表列出所有資料區域適用於 MariaDB 的 Azure 資料庫閘道的閘道 IP 位址。 下表會維護每個區域的閘道 IP 位址最新資訊。 在下表中，資料行代表下列各項：

* **閘道 IP 位址：** 此資料行會列出最新一代硬體上裝載的閘道目前的 IP 位址。 如果您要布建新的伺服器，建議您開啟用戶端防火牆，以允許此資料行中所列 IP 位址的輸出流量。
* **閘道 IP 位址 (解除委任) ：** 此欄會列出在舊版硬體上裝載的閘道 IP 位址，而目前正在解除委任。 如果您要布建新的伺服器，您可以忽略這些 IP 位址。 如果您有現有的伺服器，請繼續保留這些 IP 位址的防火牆輸出規則，因為我們尚未將其解除委任。 如果您捨棄這些 IP 位址的防火牆規則，您可能會遇到連線錯誤。 相反地，當您收到解除委任的通知時，您應該會主動將 [閘道 IP 位址] 欄中列出的新 IP 位址新增至輸出防火牆規則。 這可確保您的伺服器在遷移至最新的閘道硬體時，不會中斷與伺服器的連線。
* **閘道 IP 位址 (已解除委任) ：** 此資料行會列出閘道通道的 IP 位址，這些位址已解除委任且不再處於作業中。 您可以從輸出防火牆規則安全地移除這些 IP 位址。 


| **區功能變數名稱稱** | **閘道 IP 位址** |**閘道 IP 位址 (解除委任)** | **閘道 IP 位址 (已解除委任)** |
|:----------------|:-------------------------|:-------------------------------------------|:------------------------------------------|
| 澳大利亞中部| 20.36.105.0  | | |
| 澳大利亞 Central2     | 20.36.113.0  | | |
| 澳大利亞東部 | 13.75.149.87, 40.79.161.1     |  | |
| 澳大利亞東南部 |191.239.192.109, 13.73.109.251   |  | |
| 巴西南部 |191.233.201.8, 191.233.200.16    |  | 104.41.11.5|
| 加拿大中部 |40.85.224.249  | | |
| 加拿大東部 | 40.86.226.166    | | |
| 美國中部 | 23.99.160.139, 13.67.215.62, 52.182.136.37, 52.182.136.38 | | |
| 中國東部 | 139.219.130.35    | | |
| 中國東部 2 | 40.73.82.1  | | |
| 中國北部 | 139.219.15.17    | | |
| 中國北部 2 | 40.73.50.0     | | |
| 東亞 | 191.234.2.139, 52.175.33.150, 13.75.33.20, 13.75.33.21     | | |
| 美國東部 |40.71.8.203, 40.71.83.113 |40.121.158.30|191.238.6.43 |
| 美國東部 2 |40.79.84.180, 191.239.224.107, 52.177.185.181, 40.70.144.38, 52.167.105.38  | | |
| 法國中部 | 40.79.137.0, 40.79.129.1  | | |
| 法國南部 | 40.79.177.0     | | |
| 德國中部 | 51.4.144.100     | | |
| 德國東北部 | 51.5.144.179  | | |
| 印度中部 | 104.211.96.159     | | |
| 印度南部 | 104.211.224.146  | | |
| 印度西部 | 104.211.160.80    | | |
| 日本東部 | 13.78.61.196, 191.237.240.43, 40.79.192.23 | | |
| 日本西部 | 104.214.148.156, 191.238.68.11, 40.74.96.6, 40.74.96.7    | | |
| 南韓中部 | 52.231.32.42   | | |
| 南韓南部 | 52.231.200.86    | | |
| 美國中北部 | 23.96.178.199, 23.98.55.75, 52.162.104.35, 52.162.104.36    | | |
| 北歐 | 52.138.224.6, 52.138.224.7  |40.113.93.91 |191.235.193.75 |
| 南非北部  | 102.133.152.0    | | |
| 南非西部 | 102.133.24.0   | | |
| 美國中南部 |104.214.16.39, 20.45.120.0  |13.66.62.124  |23.98.162.75 |
| 東南亞 | 104.43.15.0, 23.100.117.95, 40.78.233.2, 23.98.80.12     | | |
| 阿拉伯聯合大公國中部 | 20.37.72.64  | | |
| 阿拉伯聯合大公國北部 | 65.52.248.0    | | |
| 英國南部 | 51.140.184.11   | | |
| 英國西部 | 51.141.8.11  | | |
| 美國中西部 | 13.78.145.25     | | |
| 西歐 |13.69.105.208,104.40.169.187 |40.68.37.158 | 191.237.232.75|
| 美國西部 |13.86.216.212, 13.86.217.212 |104.42.238.205  | 23.99.34.75|
| 美國西部 2 | 13.66.226.202  | | |
||||

## <a name="connection-redirection"></a>連接重新導向

適用於 MariaDB 的 Azure 資料庫支援額外的連線原則重新 **導向，有助於** 減少用戶端應用程式與適用于 mariadb 伺服器之間的網路延遲。 利用這項功能，在建立適用於 MariaDB 的 Azure 資料庫伺服器的初始 TCP 會話之後，伺服器會將裝載適用于 mariadb 伺服器之節點的後端位址傳回給用戶端。 之後，所有後續的封包都會直接流向伺服器，略過閘道。 當封包直接流向伺服器時，延遲和輸送量會提高效能。

具有引擎版本10.2 和10.3 的適用於 MariaDB 的 Azure 資料庫伺服器支援這項功能。

PHP [mysqlnd_azure](https://github.com/microsoft/mysqlnd_azure) 擴充功能提供重新導向的支援，由 Microsoft 開發，可在 [PECL](https://pecl.php.net/package/mysqlnd_azure)上取得。 如需如何在應用程式中使用重新導向的詳細資訊，請參閱設定重新導向[的文章。](./howto-redirection.md)

> [!IMPORTANT]
> PHP [mysqlnd_azure](https://github.com/microsoft/mysqlnd_azure) \(英文\) 延伸模組中的重新導向支援目前為預覽狀態。

## <a name="next-steps"></a>下一步

* [使用 Azure 入口網站建立和管理適用於 MariaDB 的 Azure 資料庫防火牆規則](./howto-manage-firewall-portal.md)
* [使用 Azure CLI 建立和管理適用於 MariaDB 的 Azure 資料庫防火牆規則](./howto-manage-firewall-cli.md)
