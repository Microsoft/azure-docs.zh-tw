---
title: 教學課程：特徵化和特徵規格 - 自訂決策服務
titlesuffix: Azure Cognitive Services
description: 自訂決策服務中教學課程特徵化和特徵規格的教學課程。
services: cognitive-services
author: slivkins
manager: cgronlun
ms.service: cognitive-services
ms.component: custom-decision-service
ms.topic: tutorial
ms.date: 05/08/2018
ms.author: slivkins
ms.openlocfilehash: 1e5d012706d1de5a201eecb8ad805b4d6faaf411
ms.sourcegitcommit: 0bb8db9fe3369ee90f4a5973a69c26bff43eae00
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/08/2018
ms.locfileid: "48869581"
---
# <a name="tutorial-featurization-and-feature-specification"></a>教學課程：特徵化和特徵規格

本教學課程介紹了自訂決策服務中的進階機器學習功能。 本教學課程包含兩個部分：[特徵化](#featurization-concepts-and-implementation)和[特徵規格](#feature-specification-format-and-apis)。 特徵化是指將您的資料呈現為機器學習的「特徵」。 特徵規格涵蓋 JSON 格式和指定功能的附屬 API。

依預設，自訂決策服務中的機器學習對於客戶而言一目瞭然。 其會自動從您的內容中擷取特徵，並使用標準的強化學習算法。 特徵擷取會利用其他數種 Azure 認知服務：[實體連結](../entitylinking/home.md)、[文字分析](../text-analytics/overview.md)、[表情](../emotion/home.md)，以及[電腦視覺](../computer-vision/home.md)。 如果僅使用預設特徵，可跳過本教學課程。

## <a name="featurization-concepts-and-implementation"></a>特徵化：概念及實作

自訂決策服務會逐一做出決策。 每個決策都涉及到在數個替代項目 (也稱為「動作」) 之間進行選擇。 取決於應用程式而定，決策可選擇單一動作或動作的 (簡短) 順位清單。

其中一例子即是將網站首頁上的精選文章個人化。 在此例中，動作對應到文章，而決策即是該向特定使用者顯示哪些文章。

每個動作皆由屬性的向量表示，此後稱為*特徵*。 除了自動擷取的特徵以外，您可以指定新特徵。 您也可以指示自訂決策服務　記錄某些特徵，但在進行機器學習時加以忽略。

### <a name="native-vs-internal-features"></a>原生與內部特徵

您可以使用應用程式最自然的格式來指定特徵，可能是數字、字串或陣列。 這些特徵稱為「原生特徵」。 自訂決策服務會將每個原生特徵轉譯成一或多個數值特徵，稱為「內部特徵」。

轉譯成內部特徵，如下所示：

- 數值特徵保持不變。
- 數值陣列會轉譯成幾個數值特徵，一個用於陣列的每個元素。
- 字串值的特徵 `"Name":"Value"` 依預設會轉譯成名稱為 `"NameValue"` 且值為 1 的特徵。
- 或者，字串可以[文字袋 (bag-of-words)](https://en.wikipedia.org/wiki/Bag-of-words_model) 表示。 然後，為字串中的每個字組建立一個內部特徵，其值是該字組的出現次數。
- 零值內部特徵會予以省略。

### <a name="shared-vs-action-dependent-features"></a>共用與動作相依的特徵

某些特徵是指整個決策，而且對於所有動作皆相同。 我們稱之為*共用特徵*。 一些其他特徵則專屬於特定動作。 我們稱之為*動作相依特徵* (ADF)。

在執行的範例中，共用特徵可描述使用者及/或世界各地的狀態。 例如地理位置、使用者年齡和性別，以及目前發生的重大事件等特徵。 動作相依特徵可描述特定文章的屬性，例如本文所涵蓋的各種主題。

### <a name="interacting-features"></a>互動特徵

特徵通常可「互動」：彼此之間的影響。 例如，特徵 X 是使用者是否對體育感興趣。 特徵 Y 是給定文章是否和體育相關。 特徵 Y 的作用高度依賴於特徵 X。

若要考量特徵 X 和 Y 之間的互動，請建立*二次方*特徵，其值是 X\*Y。 (也稱為 X 和 Y「交叉」。)您可以選擇要交叉哪些配對。

> [!TIP]
> 共用特徵應與動作相依特徵交叉，才可影響其順位。 動作相依特徵應與共用特徵交叉，才可參與個人化。

換句話說，未與任何 ADF 交叉的共用特徵會以相同方式影響每個動作。 未與任何共用特徵交叉相成的 ADF 也會影響每個決策。 這些特徵類型可能會降低報酬估計值的變數。

### <a name="implementation-via-namespaces"></a>透過命名空間實作

您可以在入口網站上透過「VW 命令列」實作交叉的特徵 (以及其他特徵化概念)。 語法是以 [Vowpal Wabbit](http://hunch.net/~vw/) 命令列為基礎。

實作的核心是*命名空間*的概念：具名的特徵子集。 每個特徵剛好屬於一個命名空間。 提供特徵值給自訂決策服務時，可以明確地指定命名空間。 它是參考 VW 命令列之特徵的唯一方式。

命名空間是「共用」或「動作相依」：它只包含共用的特徵，或只包含相同動作的動作相依特徵。

> [!TIP]
> 在明確指定的命名空間中包裝特徵是最好的作法。 將相關特徵分組在相同命名空間中。

如果未提供命名空間，此特徵會自動指派到預設命名空間。

> [!IMPORTANT]
> 各動作之間的特徵和命名空間不需要一致。 尤其是命名空間可以針對不同動作擁有不同特徵。 此外，可以為某些動作 (而無須為其他動作) 定義給定的命名空間。

來自相同字串值原生特徵的多個內部特徵會分組到相同的命名空間中。 位於不同命名空間中任兩個原生特徵會視為不同的特徵，即使它們有相同的特徵名稱。

> [!IMPORTANT]
> 儘管名稱很長，但描述性命名空間識別碼很常見，VW 命令列不會區分識別碼開頭為相同字母的命名空間。 在下文中，命名空間識別碼是單一字母，例如 `x` 和 `y`。

實作詳細資料如下所示：

- 若要交叉命名空間 `x` 和 `y`，請寫入 `-q xy` 或 `--quadratic xy`。 然後 `x` 中的每個特徵會與 `y` 中的每個特徵交叉。 使用 `-q x:` 以將 `x` 與每個命名空間交叉，並讓 `-q ::` 交叉所有命名空間的配對。

- 若要忽略命名空間 `x` 中的所有特徵，請寫入 `--ignore x`。

每當定義命名空間時，這些命令會分別套用至每個動作。

### <a name="estimated-average-as-a-feature"></a>以特徵預估的平均值

讓我們做一個假想實驗，如果為所有決策選擇特定動作，那麼其平均報酬為何？ 這類平均報酬可用來做為此動作之「整體品質」的量值。 無論何時 (而非在某些決策下) 選擇其他動作，皆無從得知。 不過，您可以透過增強式學習技術進行預估。 此預估的品質通常會隨著時間而改善。

您可以選擇加入「預估平均報酬」作為給定動作的特徵。 然後，當新資料到達時，自訂決策服務會自動更新此預估。 這項特徵稱為該動作的*臨界特徵*。 臨界特徵可用於機器學習和稽核。

若要新增臨界特徵，請使用 VW 命令列寫入 `--marginal <namespace>`。 使用 JSON 定義 `<namespace>`，如下所示：

```json
{<namespace>: {"mf_name":1 "action_id":1}
```

插入此命名空間以及給定動作的其他動作相依特徵。 針對所有決策，使用相同的 `mf_name` 和 `action_id` 為每個決策提供此定義。

使用 `<namespace>` 為每個動作新增臨界特徵。 `action_id` 可能是可唯一識別動作的任何特徵名稱。 特徵名稱已設為 `mf_name`。 尤其是，具有不同 `mf_name` 的臨界特徵視為不同的特徵 - 每個 `mf_name` 學習不同的權重。

預設使用為 `mf_name`，對於所有動作皆相同。 然後，針對所有臨界特徵學習一個權重。

您也可以為相同動作指定多個臨界特徵，具有相同值，但不同的特徵名稱。

```json
{<namespace>: {"mf_name1":1 "action_id":1 "mf_name2":1 "action_id":1}}
```

### <a name="1-hot-encoding"></a>獨熱編碼 (1-hot encoding)

您可以選擇以位元向量表示某些特徵，其中每個位元對應至一連串可能的值。 只有在特徵位於此範圍時，這個位元才會設為 1。 因此，有一個設為 1 的獨「熱」位元 (one "hot" bit)，其他則設為 0。 該表示通常稱為*獨熱編碼*。

獨熱編碼通常適用於分類特徵，例如「地理區域」，其沒有既定意義的數值表示法。 此外，也適用於報酬上的影響可能為非線性的數值特徵。 例如，給定的文章可能會與特定年齡群組相關，與年長或年輕的人無關。

依預設，任何字串值特徵皆為獨熱編碼：為每個可能的值建立一個獨特的內部特徵。 目前未提供適用於數值特徵及/或具有自訂範圍的自動獨熱編碼。

> [!TIP]
> 機器學習演算法會以統一的方式處理給定內部特徵的所有可能值：透過一般「權重」。 獨熱編碼允許每個值範圍具有單獨的「權重」。 一旦收集到足夠的資料，縮小範圍可產生更好的報酬，但可能會增加收斂為良好報酬所需的資料量。

## <a name="feature-specification-format-and-apis"></a>特徵規格：格式和 API

您可以透過數個附屬 API 指定特徵。 所有 API 皆使用一般的 JSON 格式。 以下是概念層面上的 API 和格式。 規格由 Swagger 結構描述予以輔助。

特徵規則的基本 JSON 範本如下所示：

```json
{
"<name>":<value>, "<name>":<value>, ... ,
"namespace1": {"<name>":<value>, ... },
"namespace2": {"<name>":<value>, ... },
...
}
```

這裡的 `<name>` 和 `<value>` 分別代表特徵名稱和特徵值。 `<value>` 可以是字串、整數、浮點數、布林值或陣列。 未包裝到命名空間的特徵會自動指派到預設命名空間。

若要以文字袋表示字串，請使用特殊語法 `"_text":"string"`，而非 `"<name>":<value>`。 實際上，會為字串中的每個字組建立一個單獨的內部特徵。 其值為該字組的發生次數。

如果 `<name>` 開頭為 "_" (而非 `"_text"`)，則會忽略此特徵。

> [!TIP]
> 有時候您會從多個 JSON 來源合併特徵。 為了方便起見，您可以使用下列方式表示：
>
> ```json
> {
> "source1":<features>,
> "source2":<features>,
> ...
> }
> ```

這裡的 `<features>` 是指先前定義的基本特徵規格。 也允許更深層的「巢狀結構」。 自訂決策服務會自動尋找可以解譯為 `<features>` 的「最深層」JSON 物件。

#### <a name="feature-set-api"></a>特徵集 API

特徵集 API 會傳回先前所述的 JSON 格式的特徵清單。 您可以使用數個特徵集 API 端點。 每個端點是根據特徵集識別碼和 URL 進行識別。 特徵集識別碼和 URL 之間的對應已在入口網站上設定。

藉由在 JSON 中的適當位置插入對應的特徵集識別碼以呼叫特徵集 API。 對於動作相依特徵，呼叫將由動作識別碼自動參數化。您可以為相同的動作指定數個特徵集識別碼。

#### <a name="action-set-api-json-version"></a>動作集 API (JSON 版本)

動作集 API 有一個版本，其中動作和特徵皆以 JSON 指定。 可以利用明確的方式及/或透過特徵集 API 指定特徵。 可以為所有動作指定一次共用特徵。

#### <a name="ranking-api-http-post-call"></a>排名 API (HTTP POST 呼叫)

排名 API 具有使用 HTTP POST 呼叫的版本。 此呼叫的主體透過彈性的 JSON 語法指定動作與特徵。

可以利用明確的方式及/或透過動作集識別碼指定動作。 每當遇到動作集識別碼時，會執行對應動作集 API 端點的呼叫。

至於動作集 API，可以利用明確的方式及/或透過特徵集 API 指定特徵。 可以為所有動作指定一次共用特徵。