---
title: 使用 Project Acoustics 來製作聲場 - 認知服務
description: 本文件說明使用 Unity 編輯器延伸模組來提交聲場製作項目的流程。
services: cognitive-services
author: kegodin
manager: noelc
ms.service: cognitive-services
ms.component: acoustics
ms.topic: article
ms.date: 08/17/2018
ms.author: kegodin
ms.openlocfilehash: 0e16ec765ae3cbef8a941f43a149428ffdf5bd8d
ms.sourcegitcommit: 1aedb52f221fb2a6e7ad0b0930b4c74db354a569
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/17/2018
ms.locfileid: "40181938"
---
# <a name="bake-acoustics"></a>製作聲場

本文件說明使用 Unity 編輯器延伸模組來提交聲場製作項目的流程。 如需了解聲場的詳細背景，請參閱[什麼是聲場](what-is-acoustics.md)。 如需快速入門指南，請參閱[使用者入門](getting-started.md)。

## <a name="import-the-plugin"></a>匯入外掛程式

將 Acoustics (聲場) 外掛程式匯入到您的專案中。 然後從 Unity 功能表中選擇 [Window] \(視窗\) > [Acoustics] \(聲場\) 以開啟 Acoustics (聲場) UI：

![開啟 [Acoustics] \(聲場\) 視窗](media/WindowAcoustics.png)

## <a name="principles"></a>原則

[Acoustics] \(聲場\) 工具視窗會收集聲場引擎為場景計算聲場時所需的資訊。 有五個進行製作的步驟：

1. 建立或標示玩家導航網格
2. 標示聲場幾何
3. 將聲場材質屬性指派給幾何
4. 預覽探查位置
5. 製作

製作完成之後，請參閱[聲場的設計流程概觀](design-process.md)，以了解選擇性的製作後設計步驟。

## <a name="create-or-mark-a-navigation-mesh"></a>建立或標示導航網格

導航網格可用來放置模擬探查點。 您可以使用 Unity 的[導航網格工作流程](https://docs.unity3d.com/Manual/nav-BuildingNavMesh.html)，或是指定自己的導航網格。 聲場系統將會採用以 Unity 工作流程建立的導航網格。 若要使用您自己的網格，請從 [Objects] \(物件\) 索引標籤標示它們，如下一個步驟所述。

## <a name="objects-tab"></a>物件索引標籤

開啟 [Acoustics] \(聲場\) 視窗的 [Objects] \(物件\) 索引標籤。 請使用此索引標籤來標示您場景中的物件，這只會將 **AcousticsGeometry** 或 **AcousticsNavigation** 元件新增至該物件。 您也可以使用[標準 Unity 元件工作流程](https://docs.unity3d.com/Manual/UsingComponents.html)來對物件進行標示或取消標示。

選取場景視窗或階層中的一或多個物件，然後針對 **AcousticsGeometry** 或 **AcousticsNavigation** 對物件進行標示或取消標示，如下所述。 如果未選取任何物件，則可一次對場景中的所有物件進行標示或取消標示。

可標示的物件僅限 Mesh Renderer (網格轉譯器) 和 Terrain (地形)。 所有其他物件類型都會被忽略。 核取方塊將會對所有受影響的物件進行標示或取消標示。

如果您的場景中沒有任何已選取的物件，看起來就會類似下圖：

![未選取任何物件時的 [Objects] \(物件\) 索引標籤](media/ObjectsTabNoSelectionDetail.png)

如果您的場景中有已選取的物件，則看起來會類似下圖：

![未選取任何物件時的 [Objects] \(物件\) 索引標籤](media/ObjectsTabWithSelectionDetail.png)

### <a name="objects-tab-parts"></a>物件索引標籤組件

索引標籤頁面的組件包括：

1. 索引標籤選取按鈕 (已選取 [Objects] \(物件\) 索引標籤)。 請使用這些按鈕來逐步完成進行聲場製作的各種步驟 (由左至右)。
2. 使用此頁面時所需執行之操作的簡短描述。
3. 階層視窗的可用篩選。 請使用此組件將階層視窗篩選成顯示所指定類型的物件，以便更容易標示這些物件。 如果您尚未針對聲場標示任何物件，則選取最後兩個選項將不會顯示任何內容。 不過，一旦您已標示物件，它們便可協助您找出已標示的物件。
4. 未選取任何物件時，此區段會顯示場景中所有物件的狀態：
    * Total (全部) - 場景中的作用中、非隱藏物件總數。
    * Ignored (已忽略) - 不是 Mesh Renderer (網格轉譯器) 或 Terrain (地形) 的物件數目。
    * Mesh (網格) - 場景中的 Mesh Renderer (網格轉譯器) 物件數目
    * Terrain (地形) - 場景中的 Terrain (地形) 物件數目
    * Geometry (幾何) - 場景中標示為 [Acoustics Geometry] \(聲場幾何\) 的 Mesh (網格) 或 Terrain (地形) 物件數目
    * Navigation (導航) - 場景中標示為 [Acoustics Navigation] \(聲場導航\) 的 Mesh (網格) 或 Terrain (地形) 物件數目 此數目不包含 Unity 的 NavMesh。
5. 顯示場景中「可標示的」物件 (僅限 Mesh Renderer (網格轉譯器) 和 Terrain (地形)) 總數。 顯示您可用來將這些物件標示為 (為其新增適當的元件) 用於聲場之幾何或導航的核取方塊
6. 未選取任何物件時，如有需要，此附註會提醒您選取物件來進行標示。 您也可以在不選取任何物件的情況下，選取一個或同時選取兩個核取方塊來標示場景中的所有物件。
7. 已選取物件時，此區段只會顯示所選物件的狀態。
8. 顯示「可標示的」所選物件總數。 選取或取消選取核取方塊只會對選取的物件進行標示或取消標示。

如果有些物件已標示而有些未標示，則適當的核取方塊會顯示「混合」值：

![混合值核取方塊](media/MixedObjectSelectionDetail.png)

按一下此核取方塊會強制標示所有物件，再按一下則會將所有物件都取消標示。

您可以將物件標示成用於幾何和導航。

### <a name="guidelines-for-marking-objects"></a>標示物件的指導方針

如果物件應該遮蔽、反射或吸收聲音，請務必將其標示為 [Acoustics Geometry] \(聲場幾何\)。 聲場幾何可以包括地面、牆面、屋頂、窗戶和窗戶玻璃、地毯及大型家具。 您也可以包括較小的物件 (例如燈、裝飾品、燈座)，因為它們不會明顯增加製作成本。 請勿遺漏主要元素，例如地面或天花板。 此外，請勿包括不應該影響聲場的物件，例如碰撞網格。

製作結果中會修正進行探查計算 (透過下方的 [Probes] \(探查\) 索引標籤) 時的物件轉換。 如果移動場景中任何已標示的物件，將必須重做探查計算及重新製作場景。

## <a name="materials-tab"></a>材質索引標籤

標示您的物件之後，請按一下 [Materials] \(材質\) 按鈕以移至 [Materials] \(材質\) 索引標籤。

### <a name="parts-of-the-materials-tab"></a>[Materials] (材質) 索引標籤的組件

![[材質] 索引標籤詳細資料](media/MaterialsTabDetail.png)

1. 用來顯示此頁面的 [Materials] \(材質\) 索引標籤按鈕，。
2. 使用此頁面時所需執行之操作的簡短描述。
3. 已選取時，只會列出標示為 [Acoustics Geometry] \(聲場幾何\) 之物件所使用的材質。 否則，會列出場景中所使用的所有材質。
4. 使用這些選項來變更按一下下方 [Acoustics] \(聲場\) 欄 (第 6 點) 中的下拉式清單時，所顯示下拉式功能表的順序。 [Name] \(名稱\) 會將聲場材質依名稱排序。 [Absorptivity] \(吸收性\) 則會將它們依吸收性由低至高排序。
5. 場景中所使用的材質清單，依字母順序排序。 如果選取 [Show Marked Only] \(只顯示已標示的物件\) (第 3 點)，便只會列出標示為 [Acoustics Geometry] \(聲場幾何\) 之物件所使用的材質。 按一下這裡的某個材質，就會選取場景中使用該材質的所有物件。
6. 顯示作為場景材質指派對象的聲場材質。 按一下下拉式清單，即可將場景材質重新指派給不同的聲場材質。 您可以使用上面的 [Sort Acoustics By] \(聲場排序依據\) 選項 (第 4 點)，來變更按一下此處項目時所顯示功能表的排序順序。
7. 顯示在上一欄中所選材質的聲場吸收係數。 值為零時表示完全反射 (沒有任何吸收)，值為 1 時則表示完全吸收 (沒有任何反射)。 除非所選材質為 [Custom] \(自訂\)，否則無法變更吸收係數。
8. 針對指派給 [Custom] \(自訂\) 的材質，滑桿便不再停用，您可以使用滑桿或透過輸入值來選擇吸收係數。 如需有關材質屬性的詳細資訊，請參閱[聲場的設計流程概觀](design-process.md)。

### <a name="guidelines-for-assigning-materials-or-absorption-values"></a>指派材質 (或吸收值) 的指導方針

此索引標籤會根據名稱嘗試猜測您材質的吸收率。 例如，如果您的場景材質名稱為 LivingRoom_WoodTable，則指派給它的初始聲場材質將會是 [wood] \(木材\)。 針對無法判斷出已知材質的材質，系統會為其指派 [Default] \(預設\) 材質，其吸收率類似於混凝土。

您可以為每個場景材質重新指派聲場材質。 例如，如果室內音的殘響太大，請將牆面、地板或天花板的聲場材質變更成吸收性更高的材質。 聲場材質指派會套用至使用該場景材質的所有物件。

## <a name="probes-tab"></a>探查索引標籤

指派材質之後，請切換至 [Probes] \(探查\) 索引標籤。

### <a name="parts-of-the-probes-tab"></a>[Probes] \(探查\) 索引標籤的組件

![[Probes] \(探查\) 索引標籤詳細資料](media/ProbesTabDetail.png)

1. 用來顯示此頁面的 [Probes] \(探查\) 索引標籤按鈕
2. 使用此頁面時所需執行之操作的簡短描述
3. 使用這些來選擇粗略或精細模擬解析度。 [Coarse] \(粗略\) 的執行速度較快，但會有所取捨。 如需詳細資料，請參閱下面的[粗略與精細解析度的比較](#Coarse-vs-Fine-Resolution)。
4. 使用此欄位來選擇聲場資料檔的預期放置位置。 按一下具有 "..." 的按鈕以使用資料夾選擇器。 預設值為 **Assets/AcousticsData**。 此外，也會在此位置底下建立一個 [Editor] 子資料夾。 如需有關資料檔的詳細資訊，請參閱下面的[資料檔](#Data-Files)。
5. 此場景的資料檔將會採用這裡提供的前置詞來命名。 預設值為 "Acoustics_[Scene Name]"。
6. 計算探查之後，就會停用上述控制項。 按一下 [Clear] \(清除\) 按鈕以清除計算並啟用控制項，以便讓您能夠使用新的設定來重新計算。
7. 按一下 [Calculate] \(計算\) 按鈕以將場景體素化 (Voxelize) 及計算探查點位置。 這會在您電腦本機完成，且必須在進行製作之前完成。

在這個版本的 Project Acoustics 中，無法手動放置探查，而必須透過 [Probes] \(探查\) 索引標籤中提供的自動化流程放置。

### <a name="what-the-calculate-button-calculates"></a>[Calculate] \(計算\) 按鈕會計算什麼

[Calculate] \(計算\) 按鈕會取用您到目前為止已提供的資料 (幾何、導航、材質，以及粗略/精細設定)，然後進行下列數個步驟：

1. 它會從場景網格中取用幾何，然後計算出體素體積。 體素體積是一個圍繞您整個場景的 3D 體積，由小型的立方體「體素」所組成。 體素的大小取決於 [Simulation Resolution] \(模擬解析度\) 設定所設定的模擬頻率。 每個體素都會標示為 [open air] \(室外\) 或包含場景幾何。 如果體素包含幾何，體素上就會標示指派給該幾何之材質的吸收係數。
2. 接著，它會使用導航資料來計算出玩家可能前往的聲場相關位置。 它會嘗試找出合理的一小組位置，這些位置包括較小的區域，例如門口和走廊，再到室內及開放空間。 就小型場景而言，這通常會少於 100 個位置，而大型場景則可能會有高達上千個位置。
3. 針對它所計算的每個最終聆聽者位置，它會決定一些參數，例如空間的「開放度」和所在房間的大小等。
4. 這些計算的結果會儲存在您所指定位置的檔案中 (請參閱下面的[資料檔](#Data-Files))

視您場景的大小和機器的運算速度而定，這些計算可能會花費數分鐘的時間。

在這些計算完成之後，您可以預覽體素資料和探查點位置，以協助確保製作會提供您理想的結果。 諸如不良導航網格或遺漏/有多餘幾何等情況，在預覽中通常都可迅速發現，讓您能夠加以更正。

### <a name="scene-rename"></a>場景重新命名

場景名稱可用來將場景連接至儲存探查點位置和體素化設定的檔案。 如果在計算出探查點之後將場景重新命名，就會遺失材質指派和位置資料，而應該重新執行。

## <a name="debug-display-through-gizmos"></a>透過 Gizmos 對顯示進行偵錯

[探查] \(Probes\) 和 [Voxels] \(體素\) Gizmos 預設都會開啟。 這些會顯示已計算出的體素和探查點位置。 您可以使用 Gizmos 功能表來啟用或停用它們：

![Gizmos 功能表](media/GizmosMenu.png)

### <a name="voxels"></a>體素

體素在場景視窗中會顯示成圍繞參與之幾何的綠色立方體。 不會顯示只含空氣的體素。 有一個大型綠色方塊會圍繞您的整個場景，代表了在模擬中將使用的完整體素體積。
請繞著您的場景移動，確認應該是幾何的每個項目都有體素。 場景相機必須位於物件的大約 5 公尺以內，才能顯示體素。

如果您將以「粗略」解析度和以「精細」解析度建立的體素做比較，您將會發現粗略體素的體積是兩倍大。

![體素預覽](media/VoxelCubesPreview.png)

### <a name="probe-points"></a>探查點

探查點相當於可能的玩家 (聆聽者) 位置。 進行製作時，會為每個這些探查點計算場景中任何一處聲音來源的聲場。 如果玩家不是直接位於探查點位置，則會使用離玩家最近之探查點的資料來插補該位置的參數。

因此，請務必確定在玩家於場景中預期行經的任何地方都有探查點，並以適當方式表現出小型區域和門口。 Project Acoustics 引擎會根據您場景幾何的解譯放置探查點，您無法在此「設計人員預覽」中移動或編輯這些探查點。 請改為使用它們來確認您幾何製作及導航提示資料的正確性。

![探查預覽](media/ProbesPreview.png)

### <a name="Coarse-vs-Fine-Resolution"></a>粗略與精細解析度之比較

[Coarse] \(粗略\) 與 [Fine] \(精細\) 解析度設定之間的唯一差異在於模擬執行頻率。 「精細」所使用的頻率為「粗略」的兩倍。
雖然這看似簡單，但在聲場模擬上具有一些含意：

* 「粗略」的波長為「精細」的兩倍，因此體素是兩倍大。
* 模擬時間與體素大小直接相關，因此「粗略」製作比「精細」製作快 16 倍。
* 針對小於體素大小的門戶 (例如門或窗) 將無法進行模擬。 「粗略」設定可能導致不會模擬部分這些較小的門戶；因此在執行階段，它們將不會傳遞聲音。 您可以檢視體素來查看是否會發生這種情況。
* 模擬頻率越低，在角落和邊緣周圍產生的繞射就越少。
* 聲音來源不能位於「已填滿的」體素 (也就是包含幾何的體素) 內，這會導致沒有聲音。 這會更難找出聲音來源，因此它們不會在與使用「精細」設定相比更大的「粗略」設定體素內。
* 較大的體素侵入門戶的部分也較大，如下所示。 第一張圖是使用「粗略」解析度來建立的，第二張圖是相同的門口，但使用「精細」解析度。 如紅色標記所示，使用「精細」設定時，侵入門口的部分較小。 藍線是幾何所定義的門口，紅線則是體素大小所定義的有效聲場門戶。 此入侵狀況在指定的情況下會如何表現，完全取決於體素與門戶幾何的對齊方式，而這又取決於場景中物件的大小和位置。

![粗略門口](media/CoarseVoxelDoorway.png)

![精細門口](media/FineVoxelDoorway.png)

## <a name="bake-tab"></a>製作索引標籤

對預覽資料感到滿意之後，請使用 [Bake] \(製作\) 索引標籤將製作項目提交至雲端。

### <a name="parts-of-the-bake-tab"></a>製作索引標籤的組件

![[Bake] \(製作\) 索引標籤詳細資料](media/BakeTabDetails.png)

1. 用來顯示此頁面的 [Bake] \(製作\) 索引標籤按鈕。
2. 要在此頁面上執行之操作的簡短描述。
3. 建立您的 Azure 帳戶之後，用來輸入 Azure 認證的欄位。 如需詳細資訊，請參閱[建立 Azure Batch 帳戶](create-azure-account.md)。
4. 要用於計算的 Azure Batch 計算節點類型。 此節點類型必須是您 Azure 資料中心位置支援的類型。 如果不確定，請保持為 **Standard_F8**。
5. 要用於此計算的節點數目。 您在這裡輸入的數目會影響完成製作的時間，並且會受到 Azure Batch 核心配置限制。 預設配置只允許兩個 8 核心節點或一個 16 核心節點，但可以擴充。 如需有關核心配置條件約束的詳細資訊，請參閱[建立 Azure Batch 帳戶](create-azure-account.md)。
6. 您場景的探測計數，如 [Probes] \(探測\) 索引標籤上所計算。探測數目會決定需要在雲端執行的模擬次數。 您指定的節點數目不可超過探測數目。
7. 您的作業在雲端執行時預期將耗用的時間長度。 這不包括節點啟動時間。 作業開始執行之後，這大約會等於取得結果所需的時間。 請注意，這只是一個預估值。
8. 執行模擬所需的運算時間量總計。 這是將在 Azure 中使用的節點計算時間量總計。 如需有關使用此值的詳細資訊，請參閱下面的[預估製作成本](#Estimating-bake-cost)。
9. 此訊息會告訴您在作業結束之後會將製作結果儲存在哪裡。
10. (僅限進階使用) 如果您因某個原因而需要強制 Unity 忘記您已提交的製作項目 (例如您已使用另一部機器來下載結果)，請按一下 [Clear State] \(清除狀態\) 按鈕來忘記已提交的作業。 請注意，這意謂著在備妥結果檔案時，將**不會**下載結果檔案，**這與取消作業並不相同**。 作業如果正在執行，將會繼續在雲端執行。
11. 按一下 [Bake] \(製作\) 按鈕以將製作項目提交至雲端。 當作業正在執行時，這會改為顯示 [Cancel Job] \(取消作業\)。
12. 此區域會顯示製作狀態。 完成時，應該會顯示 [Downloaded] \(已下載\)。

您一律可以在 [Azure 入口網站](https://portal.azure.com)取得有關作用中作業、計算集區及儲存體的完整資訊。

當作業正在執行時，[Bake] \(製作\) 按鈕會變更為 [Cancel Job] \(取消作業\)。 使用此按鈕即可取消進行中的作業。 刪除工作之前，系統會先要求您確認。 取消作業後即無法復原、將無法取得任何結果，且您仍然需支付任何已使用的 Azure 計算時間費用。

在您開始製作之後，即可關閉 Unity。 視專案、節點類型與節點數目而定，雲端製作可能會花費數小時的時間。 當您重新載入專案並開啟 [Acoustics] \(聲場\) 視窗時，製作作業狀態將會更新。 如果作業已完成，系統將會下載輸出檔。

Azure 認證會安全地儲存在您的本機電腦上，並與您的 Unity 編輯器建立關聯。 它們僅供用來與 Azure 建立安全連線。

### <a name="Estimating-bake-cost"></a> 預估製作成本

若要預估所指定製作項目的成本，請取用在 [Estimated Compute Cost] \(預估計算成本\) 顯示的值 (這是一個持續時間)，然後將其乘以您所選 [VM Node Type] \(VM 節點類型\) 的每小時成本 (採用您的當地貨幣)。 此結果將不會包含讓節點啟動並開始執行所需的節點時間。 例如，如果您選取 [Standard_F8] 作為您的節點類型，其成本為每小時 0.75 美元，而 [Estimated Compute Cost] \(預估計算成本\) 為 3 小時又 57 分鐘，則執行作業的預估成本將會是 0.75 美元 * ~4 小時 = ~3.00 美元。 實際成本可能會稍微高一點，因為讓節點啟動需要額外的時間。 您可以在 [Azure Batch 定價](https://azure.microsoft.com/pricing/details/virtual-machines/linux) 頁面上找到每小時節點成本 (針對類別選取 [計算最佳化] 或 [高效能計算])。

### <a name="reviewing-the-bake-results"></a>檢閱製作結果

在製作完成之後，請執行執行階段外掛程式，以確認體素和探查點是否都位於其預期位置。 如需詳細資訊，請參閱[聲場的設計流程概觀](design-process.md)。

## <a name="Data-Files"></a>資料檔

此外掛程式會在各種點上建立四個資料檔。 在執行階段只需要其中一個，因此其他三個會在名為 "Editor" 的資料夾中，如此便不會將它們編譯至您的專案中。

* **Assets/Editor/[SceneName]\_AcousticsParameters.asset**：此檔案儲存您在 Acoustics (聲場) UI 的欄位中輸入的資料。 您無法變更此檔案的位置和名稱。 此檔案中儲存了其他會影響製作的值，但它們是供進階使用者使用的，而不應該予以變更。
* **Assets/AcousticsData/Acoustics\_[SceneName].ace.bytes**：此檔案是在製作模擬期間建立的檔案，包含了執行階段用來轉譯您場景聲場的查閱資料。 您可以使用 [Probes] \(探查\) 索引標籤上的欄位，來變更此檔案的位置和名稱。
* **Assets/AcousticsData/Editor/Acoustics_[SceneName].vox**：此檔案儲存體素化的聲場幾何和材質屬性。 這是使用 [Probes] \(探查\) 索引標籤上的 [Calculate] \(計算\) 按鈕來計算的。您可以使用 [Probes] \(探查\) 索引標籤上的欄位，來變更此檔案的位置和名稱。
* **Assets/AcousticsData/Editor/Acoustics\_[SceneName]\_config.xml**：此檔案儲存使用 [Probes] \(探查\) 索引標籤上的 [Calculate] \(計算\) 按鈕來計算的參數。您可以使用 [Probes] \(探查\) 索引標籤上的欄位，來變更此檔案的位置和名稱。

請小心，不要刪除從製作項目下載的 *.ace.bytes 檔案。 除非重新製作場景，否則無法復原此檔案。

## <a name="next-steps"></a>後續步驟
* 在[聲場的設計流程概觀](design-process.md)中，將製作結果套用至聲音來源。

